<html style="padding:0;margin:0;background-color:#333">

<head>
    <meta charset="UTF-8">
    <title>Listricity - Online Music Player</title>
    <meta name="Description" content="Free online music player and playlist manager. Create awesome playlists by selecting from YouTube’s mixes and Up-Next suggestions, with a supercool radio mode which buffs up lists with similar tracks.">
    <meta property="og:url" content="http://www.listricity.com">
    <meta property="og:title" content="Listricity - Cloud Music Player">
    <meta property="og:description" content="Free online music player and playlist manager. Create awesome playlists by selecting from YouTube’s mixes and Up-Next suggestions, with a supercool radio mode which buffs up lists with similar tracks.">
    <meta property="og:image" content="listricity.png">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="listricity">

    <meta name="description" content="listricity is a free online playlist maker and music player. Create music playlists by grading tracks suggestions." />
    <meta name="keywords" content="free music , music player , free online music , listen free music , music players , digital music player , free music player , get free music , free music players , free music songs , play free music , free music site, on demand music"
    />
    <meta name="keywords" content="מוזיקה, מוסיקה, אונליין, און ליין, נגן, באינטרנט, ברשת, חינם, חופשי, האזנה, שירים בעברית, שירים ישראלים, מוזיקה און ליין" />

    <meta name="DC.Title" content="istricity - Cloud Music Player" />
    <meta name="DC.Subject" content="Music" />
    <meta name="DC.Subject" content="Player" />
    <meta name="DC.Subject" content="On-demand" />
    <meta name="DC.Subject" content="Video" />
    <meta name="DC.Description.abstract" content="listube - online on demand free and unlimited music player. Make your online music playlists and share them with your friends." />
    <meta name="DC.Type" scheme="DCMIType" content="Sound" />


    <script>
        if (window.screen.availHeight + window.screen.availWidth < 1560) {
            document.location.href = 'index_mobile.html';
        }
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/ui-darkness/jquery-ui.css" rel="stylesheet">
    <script>
        //window.$ = window.jQuery = require('./jquery.min.js');

        // detect IE

        /**
         * detect IE
         * returns version of IE or false, if browser is not Internet Explorer
         */

        function detectIE() {
            var ua = window.navigator.userAgent;

            // Test values; Uncomment to check result …

            // IE 10
            // ua = 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)';

            // IE 11
            // ua = 'Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko';

            // IE 12 / Spartan
            // ua = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36 Edge/12.0';

            // Edge (IE 12+)
            // ua = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10586';

            var msie = ua.indexOf('MSIE ');
            if (msie > 0) {
                // IE 10 or older => return version number
                return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
            }

            var trident = ua.indexOf('Trident/');
            if (trident > 0) {
                // IE 11 => return version number
                var rv = ua.indexOf('rv:');
                return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
            }

            var edge = ua.indexOf('Edge/');
            if (edge > 0) {
                // Edge (IE 12+) => return version number
                return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
            }

            // other browser
            return false;
        }


        //var childProcess = require("child_process");

        function opener(args, options, callback) {
            window.open(args, '_blank');
            return;
            var command = process.platform === "win32" ? "cmd" :
                process.platform === "darwin" ? "open" :
                "xdg-open";

            if (typeof args === "string") {
                args = [args];
            }

            if (typeof options === "function") {
                callback = options;
                options = {};
            }

            if (options && typeof options === "object" && options.command) {
                if (process.platform === "win32") {
                    args = [options.command].concat(args);
                }
                else {
                    command = options.command;
                }
            }

            if (process.platform === "win32") {
                args = args.map(function(value) {
                    return value.replace(/&/g, '^&');
                });
                args = ["/c", "start", '""'].concat(args);
            }

            return childProcess.execFile(command, args, options, callback);
        }
    </script>

    <script src="extras.js">
    </script>

    <link href="index.css" rel="stylesheet">
    <style>
        #coverad {
            position: fixed;
            bottom: 48px;
            right: 0px;
            background-color: black;
            height: 96px;
            z-index: 999999;
            left: 294px;
            box-sizing: border-box;
            npointer-events: none;
            color: #777;
            padding-right: 19px;
            font-size: 7vh;
            text-align: right;
            line-height: 96px;
            border-top: 1px solid #333;
            overflow: hidden;
            display: none;
            transition: height .2s, left .2s, bottom .2s;
            cursor: pointer;
        }
        
        #coverad img {
            height: 100%;
            border: 4px solid black;
            box-sizing: border-box;
            float: left;
            border-radius: 4px;
        }
        
        .coveradmin img {
            height: 43px!important;
            border: 0px solid black!important;
            margin-top: -13px;
        }
        
        .coveradmin {
            font-size: 9px!important;
            height: 23px!important;
            border-radius: 1px;
            left: auto!important;
            line-height: 11px!important;
            width: 161px;
            border-top: none!important;
            text-align: left!important;
            padding-right: 0!important;
            padding-top: 2px;
            padding-bottom: 0;
            margin-bottom: -22px!important;
            bottom: 100vh!important;
            right: 0!important;
            box-shadow: -1px -1px 1px 0px black;
            padding-bottom: 0;
        }
        
        .closebg {
            background-image: none!important;
            z-index: 99999;
        }
        
        #q {
            transition: all .3s;
        }
        
        #q:focus {
            font-size: 20px!important;
        }
        
        .clabel {
            display: none;
        }
        
        @media only screen and (min-width: 1150px) {
            .clabel {
                display: inline-block;
            }
        }
        
        .logofullview {
            left: 295px!important;
            right: 0px!important;
            width: auto!important;
            bottom: 0px!important;
            height: auto!important;
            z-index: 9999!important;
            top: 23px!important;
            box-shadow: none!important;
        }
        
        .faqgroup {
            padding: 10px;
            background: rgb(139, 138, 134);
            border-radius: 10px;
        }
        
        span.faqq {
            font-size: 30px;
            font-style: italic;
            font-weight: bolder;
            margin-left: -34px;
            background-color: rgb(139, 138, 134);
            border-radius: 5px 0 0 5px;
            padding: 2px 14px 10px 10px;
            margin-top: -10px;
            display: inline-block;
            font-family: serif;
            line-height: 1;
        }
        
        button.playbutton:after {
            margin-right: 6px;
            border-top: 17px solid transparent;
            border-bottom: 17px solid transparent;
            border-left: 6px solid #C1C1C1;
            content: "";
            position: absolute;
            margin-left: 9px;
            margin-top: -4px;
        }
        
        .suglist>.vidui:hover {
            transition: box-shadow 0.3s ease-in-out;
            nbox-shadow: 0 0 30px #000;
            box-shadow: 0 0 30px -10px #000000;
        }
        
        #logo {
            background-size: contain;
            background-position: center;
            box-shadow: inset -3px 0px 0px -1px, 2px 0px 1px -1px;
            background-color: black;
        }
        
        .suglist .vidui div.title {
            color: rgba(218, 218, 218, 0.51);
            text-shadow: 1px 1px 1px rgb(16, 16, 16);
            text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.24), 0 0 0 rgba(51, 51, 51, 0.41), -1px -1px 1px rgba(0, 0, 0, 0.41);
            padding-left: 1;
            max-height: 70px;
        }
        
        .searchheader {
            margin-top: 2px;
        }
        
        #queue {
            nleft: -12px;
        }
        
        #queue .vidui .tools {
            transition: none;
            nwidth: 273px;
        }
        
        .playing {
            transition: none!important;
            transform: none;
            margin-top: 17px!important;
            margin-bottom: 0px!important;
        }
        
        .titlebar {
            -webkit-user-select: none;
            -webkit-app-region: drag;
            text-align: left;
            padding-left: 27px;
            line-height: 2;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.37);
            text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.52), 0 0 0 rgba(51, 51, 51, 0.41), -1px -1px 1px rgba(0, 0, 0, 0.42);
            font-size: 11px;
            height: 23px;
            top: 0px;
            position: fixed;
            right: 0px;
            left: 0px;
            z-index: 999;
            background-image: linear-gradient(to bottom, rgb(117, 117, 117), #585858, rgb(56, 56, 56));
            border-radius: 0px 0 0 0;
            border-top: 0px solid #777;
            border-left: 1px solid #777;
            border-bottom: 1px solid #171717;
            cursor: pointer;
            pointer-events: none;
            font-weight: 100;
            color: #ccc;
            box-shadow: inset 0 -4px 21px -12px #000;
            border-bottom: 1px solid #000;
        }
        
        playing:before {
            animation: none;
        }
        
        #why {
            transition: all .5s;
            font-size: 13px;
            z-index: 99999;
        }
        
        .closedot:hover #why {
            margin-left: -128px!important;
        }
        
        .closedot:hover {
            nmargin-right: -4px;
        }
        /*.closedot {*/
        /*    text-decoration: none;*/
        /*    float: right;*/
        /*    width: 171px;*/
        /*    height: 17px;*/
        /*    margin: -4px;*/
        /*    nmargin-right: -50px;*/
        /*    background: #3392de;*/
        /*    background: -webkit-linear-gradient(#51a9ee, #147bcd);*/
        /*    background: linear-gradient(#51a9ee, #147bcd);*/
        /*    border-color: #1482d0;*/
        /*    color: white;*/
        /*    color: #fff;*/
        /*    font-size: 13px;*/
        /*    line-height: 1.54615;*/
        /*    font-weight: 500;*/
        /*    letter-spacing: normal;*/
        /*    padding: 2px 1px 3px;*/
        /*    border: 1px solid #07c;*/
        /*    border-radius: 4px;*/
        /*    color: #fff;*/
        /*    cursor: pointer;*/
        /*    display: inline-block;*/
        /*    text-align: center;*/
        /*    text-shadow: 0 1px 1px rgba(28, 115, 184, 0.64);*/
        /*    white-space: nowrap;*/
        /*}*/
        
        .titlebar_dock:before {
            background-image: url(dock.png)!important;
        }
        
        .titlebar:before {
            content: "";
            background-position: right;
            background-image: url(undock.png);
            height: 26px;
            display: inline-block;
            width: 19px;
            background-size: 19px;
            background-position: 0px 5px;
            background-repeat: no-repeat;
            position: absolute;
            left: 3px;
            top: -3px;
            transform: rotate(-5deg);
            transition: transform .5s;
            pointer-events: auto;
        }
        
        .titlebar:hover:before {
            transform: rotate(12deg) translateY(1px) translateX(1px);
        }
        
        .closedot {
            text-decoration: none;
            float: right;
            width: 154px;
            height: 17px;
            margin: -4px;
            nmargin-right: -50px;
            background: #FF7612;
            background: -webkit-linear-gradient(#FF7F0D, #FF5821);
            background: linear-gradient(#696969, #1C191D);
            border-color: #FFC107;
            font-size: 13px;
            line-height: 1.54615;
            font-weight: 100;
            letter-spacing: normal;
            padding: 2px 0px 1px;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            display: inline-block;
            text-align: center;
            text-shadow: 0 1px 1px rgba(60, 17, 4, 0.73);
            white-space: nowrap;
            font-size: 11px;
        }
        
        .sugmore {
            text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.52), 0 0 0 rgba(51, 51, 51, 0.41), -1px -1px 1px rgba(0, 0, 0, 0.42);
        }
        
        .sugmore:hover {
            text-shadow: none;
        }
        
        .searchheader {
            text-shadow: -1px -1px 2px rgba(0, 0, 0, 0.14), 0 0 0 rgba(51, 51, 51, 0.41), -1px -1px 2px rgba(0, 0, 0, 0.26);
        }
    </style>


    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-74159004-1', 'auto');
        ga('send', 'pageview');
        window.gainited = true;
    </script>


</head>

<body style="padding:0;margin:0;background-color:#333">
    <span style="display:none">
<h1>online music player</h1><br/>
<h2>youtube playlist creator</h2><br/>
<h3>listen to music online</h3><br/>
        
    </span>
    <div id="galaxy" style="    position: fixed;
    left: 290px;
    top: 122px;
    bottom:50px;
    right:0;
        background-color: #1C1C1D;
    ">

        <div id="maincontent">


            <canvas style="display:none" id="canvas" width="350" height="150"></canvas>
            <canvas style="display:none" id="canvas3" width="570" height="570"></canvas>
            <canvas id="canvas2" width="570" height="570" style="    position: fixed;opacity:.3;z-index: -1;left: 295px;right: 0;bottom: 0px;-webkit-filter: grayscale(.5);top: 122px;width: 100vw;height: 100vh;"></canvas>















        </div>
    </div>

    <div class="titlebar" onclick="if($('#logo').is('.logofullview')){fromFullView();} else {toFullView();}">

    </div>
    <div class="closebg" style="">
        <div class="closedot">
            <a target="_blank" href="listricity_install.exe" style="text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.52), 0 0 0 rgba(51, 51, 51, 0.41), -1px -1px 1px rgba(0, 0, 0, 0.42);color: #ccc;text-decoration: none;">Download Desktop App</a>
            <div onclick="window.open('listricity_install.exe','_blank')" style="
    background: #15466D;
    padding: 17px 10px;
    margin-left: 200px;
    border-radius: 5px 0 0 5px;
    text-align: left;
    margin-top: 1px;
    " id="why">&nbsp;&nbsp;&nbsp;&nbsp; It's <b>FREE</b>,
                <br/>&nbsp;&nbsp;&nbsp;&nbsp; and packed of advanced features:
                <ul>
                    <li>Save your playlists locally
                        <br/>Safer, more persistent, bigger</li>
                    <li>An awesome Equalizer
                        <br/>Makes a real difference on laptops</li>
                    <li>Keep video on top of other windows</li>
                    <li>Oh, and no ads :-)</li>
                </ul>
                <div style="text-align: right;padding-right: 7px;">... and much much more
                    <br/>

                    <a href="download.html" onclick="window.open('download.html','_blank');event.preventDefault();return false;" target="_blank" style="
    background: #3392de;
    background: -webkit-linear-gradient(#51a9ee, #147bcd);
    background: linear-gradient(#51a9ee, #147bcd);
    border-color: #1482d0;
    color: white;
    color: #fff;
    font-size: 13px;
    line-height: 1.54615;
    font-weight: 500;
    letter-spacing: normal;
    padding: 0 10px;
    border: 1px solid #07c;
    border-radius: 4px;
    color: #fff;
    cursor: pointer;
    display: inline-block;
    text-align: center;
    text-shadow: 0 1px 1px rgba(28,115,184,0.64);
    white-space: nowrap;
    text-decoration: none;
    margin-top: 12px;
">visit site</a>

                    <a href="listricity_install.exe" onclick="event.preventDefault();return false;" target="_blank" style="
    background: #3392de;
    background: -webkit-linear-gradient(#51a9ee, #147bcd);
    background: linear-gradient(#51a9ee, #147bcd);
    border-color: #1482d0;
    color: white;
    color: #fff;
    font-size: 13px;
    line-height: 1.54615;
    font-weight: 500;
    letter-spacing: normal;
    padding: 0 10px;
    border: 1px solid #07c;
    border-radius: 4px;
    color: #fff;
    cursor: pointer;
    display: inline-block;
    text-align: center;
    text-shadow: 0 1px 1px rgba(28,115,184,0.64);
    white-space: nowrap;
    text-decoration: none;
    margin-top: 12px;
">Download</a>
                </div>
            </div>
        </div>

    </div>
    <script>
        var iprogress = 0;

        function progress(p) {
            if (p >= 100) {
                setTimeout('progress(0)', 1000)
            }
            if (p == 0) $('.progress-bar').hide();
            else if (iprogress == 0) $('.progress-bar').show();
            iprogress = p;
            $('.progress-bar').width(p + '%');
            if (p > 25 && p < 40)
                $('.progress-bar').css('background-color', '#86e01e');
            else if (p < 55)
                $('.progress-bar').css('background-color', '#f2d31b');
            else if (p < 65)
                $('.progress-bar').css('background-color', '#f2b01e');
            else if (p < 85)
                $('.progress-bar').css('background-color', '#f27011');
            else if (p > 84)
                $('.progress-bar').css('background-color', '#f63a0f');

        }

        var hto = false;
        var lastscrolltop = 0;
        var scrolltopscount = 0;
        var scolltops = [];
        var lastpeeked = new Date();
        var scrolltimer = false;
        var delspan = '<span class="del" onclick="deleteVid(@id,false);$(this).parent().remove()" style="    background-position: center;background-size: 10px;background-repeat:no-repeat;width: 16px;margin-right:5px;cursor:pointer;height: 16px;display: inline-block;margin-bottom: -4px;    margin-left: -25px;"></span>';

        var researchQueue = [];
        var researchInProgress = false;


        function setHeaders() {
            var lastscrollleft = 0;
            lastscrollleft = window.lsl;
            var nh = $(window).innerHeight() - 100; // $('#scrollspace').scrollTop() + $(window).innerHeight()+200;
            var ww = $('#stage').width();
            var ldo = false;
            var c = $('#stage .vidui').filter(function() {
                return $(this).offset().top > nh
            }).length;
            if (c > 0)
                $('.sugmore').html('Suggestions ' + (c > 0 ? '(' + c + ')' : ''));
            else if ($('#stage .vidui').length > 0)
                $('.sugmore').html('3,4 or 5 star a track to get related suggestions');
            else if ($('.genere').length > 0)
                $('.sugmore').html('Start a seach or click a music genere to get related suggestions');
            else
                $('.sugmore').html('Start a seach or click a the home button to get started');

            if ($('#help').is(':visible')) {
                var wh = $(window).height() - 250;
                var oy = $('#helptools').offset().top; //-$('#scrollspace').scrollTop();
                if (oy > wh / 2 && oy < wh && !$('#helptoolsarrow')[0].vis) {
                    $('#helptoolsarrow')[0].vis = true;
                    $('#helptoolsarrow').css('bottom', '40px');
                }
                else if ((oy < wh / 3 || oy > wh) && $('#helptoolsarrow')[0].vis) {
                    $('#helptoolsarrow')[0].vis = false;
                    $('#helptoolsarrow').css('bottom', '-500px'); //.fadeOut();
                }
                oy = $('#savetools').offset().top + 200;
                if (oy > wh / 2 && oy < wh && !$('#helpsavearrow')[0].vis) {
                    $('#helpsavearrow')[0].vis = true;
                    $('#helpsavearrow').css('top', '50px');
                }
                else if ((oy < wh / 3 || oy > wh) && $('#helpsavearrow')[0].vis) {
                    $('#helpsavearrow')[0].vis = false;
                    $('#helpsavearrow').css('top', '-500px'); //.fadeOut();
                }
                oy = $('#helpviewport').offset().top + 200;
                if (oy > wh / 2.8 && oy < wh && !$('#helpsavearrow')[0].vis) {
                    $('#helpviewportarrow')[0].vis = true;
                    $('#helpviewportarrow').css('top', '200px');
                }
                else if ((oy < wh / 2.8 || oy > wh) && $('#helpviewportarrow')[0].vis) {
                    $('#helpviewportarrow')[0].vis = false;
                    $('#helpviewportarrow').css('top', '-500px'); //.fadeOut();
                }


            }
            lastscrolltop = nh;
        }

        window.onbeforeunload = function() {
            try {}
            catch (e) {}
        };

        // const electron = require('electron');
        //const BrowserWindow = electron.BrowserWindow;
        //const ipcRenderer = electron.ipcRenderer;

        // var updateOnlineStatus = function() {
        //     ipcRenderer.send('online-status-changed', navigator.onLine ? 'online' : 'offline');
        // };

        // window.addEventListener('online', updateOnlineStatus);
        // window.addEventListener('offline', updateOnlineStatus);

        //        updateOnlineStatus();

        //var request = require('request');
        var cheerio = $.find; // require('cheerio');
        cheerio.load = $;
        var fs = {
            readFileSync: function() {
                return localStorage.getItem('playlists')
            },
            writeFile: function(f, s, cb) {
                localStorage.setItem('playlists', s);
                cb()
            }
        }; //require('fs');

        var curlistind = 0;
        var playlists = [];

        function loadLists() {
            try {
                var liststext = fs.readFileSync(window.userDataDir + '/lists.txt', 'utf8')
                playlists = JSON.parse(liststext);
                curlistind = playlists.curlistind;

            }
            catch (e) {
                console.log(e.message);
                window.newlistener = true;
                playlists = {
                    lists: [{
                        title: 'I love MUSIC!!',
                        vids: [{
                            link: '/watch?v=OPf0YbXqDm0',
                            title: 'Mark Ronson - Uptown Funk ft. Bruno Mars',
                            dur: '4:30',
                            img: 'https://i.ytimg.com/vi/OPf0YbXqDm0/mqdefault.jpg'
                        }]
                    }],
                    curlistind: 0
                }
                window.newlistener = true;
            }
            if (typeof playlists.settings == 'undefined') {
                playlists.settings = {
                    optimalLength: {
                        from: 60 * 2,
                        to: 60 * 11
                    },
                    excludes: ['greatest', 'album', 'full', 'cover', 'hits', 'collection', 'intereview'],
                    starred: {
                        star1: [],
                        star2: [],
                        star3: [],
                        star4: [],
                        star5: []
                    }
                }
            }
            if (typeof playlists.settings.starred == 'undefined') {
                playlists.settings.starred = {
                    star1: [],
                    star2: [],
                    star3: [],
                    star4: [],
                    star5: []
                }
            }
            if (typeof playlists.settings.guid == 'undefined') {
                playlists.settings.guid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    var r = Math.random() * 16 | 0,
                        v = c == 'x' ? r : r & 0x3 | 0x8;
                    return v.toString(16);
                });
                record('New Install', '');
                saveList(true, true);
            }
            else {
                record('App Started', '');
            }
            $("#amount").val(getFromToTimeText(playlists.settings.optimalLength.from, playlists.settings.optimalLength.to));
            $("#slider-range-optimal-length").slider('values', 0, playlists.settings.optimalLength.from);
            $("#slider-range-optimal-length").slider('values', 1, playlists.settings.optimalLength.to);
            $.each(playlists.settings.excludes, function(value) {
                $('#selexclude')
                    .append($("<option></option>")
                        .attr("value", playlists.settings.excludes[value])
                        .text(playlists.settings.excludes[value]));
            });
            if (playlists.settings.starred.star1.length + playlists.settings.starred.star2.length + playlists.settings.starred.star3.length + playlists.settings.starred.star4.length + playlists.settings.starred.star5.length == 0) {
                window.newlistener = true;
            }
        }

        function record(act, data) {
            if (typeof window.gainited == 'undefined' || !window.gainited) {
                setTimout('record("' + act + '","' + data + '")', 1000);
                return;
            }
            data = data || '';
            if (typeof window.recordimg == 'undefined') {
                window.recordimg = document.createElement('img');
                window.recordimg.style.display = 'none';
                document.body.appendChild(window.recordimg);
            }
            window.recordimg.src = 'http://listricity.com/record.ashx?guid=' + playlists.settings.guid + '&act=Online ' + act + '&data=' + data + '&r=' + Math.random();

            ga('send', {
                hitType: 'event',
                eventCategory: 'Online Player',
                eventAction: act,
                eventLabel: data
            });


            //alert(window.recordimg.src);
        }

        function starred(v, g) {
            try {
                for (var i = 5; i > 0; i--) {
                    for (var i1 = 0; i1 < playlists.settings.starred['star' + i].length; i1++) {
                        var v1 = playlists.settings.starred['star' + i][i1];
                        if (v1.link == v.link) {
                            playlists.settings.starred['star' + i].splice(i1, 1);
                            i1--;
                        }
                    }
                }
                playlists.settings.starred['star' + g].unshift(v);
                saveList(true, true);
            } catch (e) { debugger;}
        }

        var allvids = typeof allvids!='undefined' ? allvids :[];

        // req = request.defaults({
        //     rejectUnauthorized: false,
        //     jar: true,
        //     followAllRedirects: true // allow redirections
        // });

        var nh = '';
        var basevidtitle = '';
        var lastUpNext = '';
        var probing = false;
        var cursubvid;
        //var cookieJar = req.jar();
        var cook = '';
        var ref = '//www.youtube.com'
        var isDragging = false;
        var addMode = 'distribute';
        var lasttitle = ''
        var transitiond = 0;
        var searchsongs = [];
        var searchsongsexpected = 0;
        var searchsongsbase = '';
        var hdrs = {
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36',
            'accept-language': 'en-US,en;q=0.8,he;q=0.6',
            'pragma': 'no-cache',
            'upgrade-insecure-requests': '1',
            'cache-control': 'no-cache',
            'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'
        }
        var buffuptime = new Date();
        var buffupcurdepth = 0;
        var vididcounter = 0;
        var peektimer = false;
        var lastatt = new Date();
        var inspoint;
        var basekey = 'OfEBA0kyH-U';
        var colorind = 0;
        //var colors = ['linear-gradient(to bottom left, rgba(234, 234, 255,1), rgba(170,170,255,1)', 'linear-gradient(to bottom left, rgba(255, 234, 234,1), rgba(255,170,170,1)', 'linear-gradient(to bottom left, rgba(234, 255, 234,1), rgba(170,255,170,1)', 'linear-gradient(to bottom left, rgba(234, 255, 255,1), rgba(170,255,255,1)', 'linear-gradient(to bottom left, rgba(255, 255, 234,1), rgba(255,255,170,1)', 'linear-gradient(to bottom left, rgba(255, 234, 255,1), rgba(255,170,255,1)']
        var colors = ['linear-gradient(to bottom left, rgba(134, 134, 155,1), rgba(70,70,155,1)', 'linear-gradient(to bottom left, rgba(155, 134, 134,1), rgba(155,70,70,1)', 'linear-gradient(to bottom left, rgba(134, 155, 134,1), rgba(70,155,70,1)', 'linear-gradient(to bottom left, rgba(134, 155, 155,1), rgba(70,155,155,1)', 'linear-gradient(to bottom left, rgba(155, 155, 134,1), rgba(155,155,70,1)', 'linear-gradient(to bottom left, rgba(155, 134, 155,1), rgba(155,70,155,1)']
        var played = [];
        var curbasevid = {
            id: getVidId('root'),
            link: 'v=' + '',
            title: 'initial',
            type: 'root',
            root: 1,
            sug: []
        };


        function buffUp(c) {
            buffupcurdepth = c;
            if (c == 0) {
                //progress(100);
                return;
            }
            if (new Date() - buffuptime < 1000) {
                setTimeout('buffUp(' + c + ')', 1000);
                return;
            }
            buffuptime = new Date();
            for (var i = 0; i < c; i++) {
                var done = false;
                var sf = 99;
                while (!done && sf-- > 0) {
                    var minbuff = 999;
                    var bufv = false;
                    var bufc = false;
                    $('#queue .vidui').each(function() {
                        if (bufv) return;
                        var v = getVidById(this.id);
                        if (v.friends && v.friends.length > 0) {
                            if (!v.buffed) {
                                v.buffed = 1;
                                bufv = v;
                            }
                            else {
                                if (v.buffed < minbuff) {
                                    minbuff = v.buffed;
                                    bufc = v;
                                }
                            }
                        }
                    });
                    if (!bufv) bufv = bufc;
                    if (!bufv) {
                        done = true;
                        break;
                    } // exhosted
                    bufv = bufv.friends.shift();
                    if ($('#queue .vidui[data-link="' + bufv.link + '"]').length == 0 && isGoodVideo(bufv)) {
                        bufv.buffed++;
                        bufv.type = 'up';
                        bufv.ui = false;
                        bufv.sug = [];
                        allvids.push(bufv);
                        done = true;
                    }
                }
            }
            ui();

        }

        function autocomplete(s, response) {
            req.get({
                url: "https://clients1.google.com/complete/search?client=youtube&hl=en&gl=il&gs_rn=23&gs_ri=youtube&ds=yt&cp=5&gs_id=i&q=" + encodeURI(s) + "&callback=google.sbox.p50&gs_gbg=1Qz332c1O53rEdE7l74N",
                headers: hdrs
            }, function(err, resp, body) {
                if (err) {
                    console.log('ERR: ' + err);
                    return;
                }

                var r = [];
                if (body && body.split('[[').length > 0) {
                    body = '[[' + body.split('[[')[1].split(']],{')[0] + ']]';
                    body = eval(body);
                    for (var i = 0; i < body.length; i++) {
                        r.push(body[i][0]);
                    }
                }
                else {
                    console.log((s) + body);
                }
                response(r);

            });
        }

        function dosearch(s, type) {
            researchInProgress = true;

            var sq = s;
            basevidtitle = s;
            type = type || 'all';
            if (type == 'genere') {
                progress(10);
            }
            if (type == 'all') {
                progress(30);
                searchsongs = [];
                searchsongsbase = s;
                searchsongsexpected = 0;
                autocomplete(s, function(r) {
                    for (var i = 0; i < r.length && i < 10; i++) {
                        var q = r[i].trim().toLowerCase();
                        if (q != s.trim().toLowerCase() && isGoodTitle(q)) {
                            console.log('search as: ' + r[i]);
                            searchsongsexpected++;
                            setTimeout('dosearch("' + q + '","first")', i * 500)
                        }
                    }
                })
            }
            req.get({
                url: "https://www.youtube.com/results?search_query=" + encodeURI(s), //+' -full+-cover+-album+-best&lclk=short&filters=short',
                headers: hdrs
            }, function(err, resp, body) {
                if (err) {
                    if (type == 'first') searchsongs.push({
                        sug: []
                    })
                    researchInProgress = false;
                    console.log('ERR: ' + err);
                    return;
                }
                var vids;
                var jq = cheerio.load(body);
                var ltype = type;
                if ( //type=='genere' &&
                    jq.find('.watch-card-list, a[href*="&list="]').length > 0) {
                    var hr = jq.find('.watch-card-rhs a[href*="&list="]').attr('href');
                    if (!hr) hr = jq.find('a[href*="&list="]').first().attr('href');
                    req.get({
                        url: "https://www.youtube.com/" + hr + '&spf=navigate',
                        headers: hdrs
                    }, function(err, resp, body) {
                        if (err) {
                            console.log('ERR: ' + err);
                            return;
                        }
                        var jr = resp; //JSON.parse(body);
                        //var listjq=cheerio.load(jr[3].body['watch7-container']);
                        var listjq = cheerio.load(jr[3].body['player-playlist']);

                        var listvids = listjq.find('li.yt-uix-scroller-scroll-unit');
                        if (listvids.length == 0) {
                            listjq = cheerio.load(jr[3].body['player-playlist'].html);
                            listvids = listjq.find('li.yt-uix-scroller-scroll-unit');
                        }
                        var listvn;
                        var listind = 0;
                        //jq=$;
                        listvids.each(function() {
                            var l = $($(this).find('a')[0]).attr('href').split('&')[0];
                            var listv = {
                                id: getVidId(l),
                                basevidid: null, //curbasevid.id,
                                subvidid: cursubvid ? cursubvid.id : null,
                                link: l,
                                img: $(this).find('[data-thumb]').attr('data-thumb') || $(this).find('[src]').attr('src'),
                                title: $($(this).find('a')[0]).attr('title') || $(this).find('.title').html() || $(this).find('h4').html().trim(),
                                type: listind == 0 ? 'list' : 'sug',
                                desc: (type == 'genere' ? 'Genere: ' + sq.replace(' music', '') : 'Related to: ' + basevidtitle),
                                dur: $($(this).find('.accessible-description,.video-time')[0]).text().replace('- Duration: ', '').replace('.', '').trim() || '3:33',
                                views: $($(this).find('.view-count')[0]).text().split(' ')[0]
                            };
                            if (!vidExists(listv, 'all') && listv.title) {
                                if (!isGoodTitle(listv.title)) return;
                                allvids.push(listv);
                                if (listvn) listvn.sug.push(listv);
                                if (listind == 0) {
                                    listvn = listv;
                                    listv.sug = []
                                };
                                listind++;
                            }
                        })
                        ui();
                    });

                    if (type == 'genere') {
                        researchInProgress = false;
                        return;
                    }
                }
                researchInProgress = false;
                vids = jq.find('.yt-lockup-video');
                var sss = {
                    sug: []
                };
                if (type == 'first') {
                    searchsongs.push(sss);
                }
                else {
                    var vn = {
                        id: getVidId(s),
                        link: '',
                        img: '',
                        title: s,
                        type: 'search',
                        desc: searchsongsbase
                    };
                    vn.sug = []
                    allvids.push(vn);
                }

                vids.each(function() {
                    var img = $(this).find('.yt-thumb-simple>img').attr('src');
                    if (img.indexOf('pixel') > -1) img = $(this).find('.yt-thumb-simple>img').attr('data-thumb');
                    var title = $(this).find('h3.yt-lockup-title>a').html();
                    var href = $(this).find('h3.yt-lockup-title>a').attr('href');

                    var l = $($(this).find('a')[0]).attr('href');

                    var v = {
                        id: getVidId(l),
                        link: l,
                        img: img,
                        title: title,
                        type: 'sug',
                        dur: $($(this).find('.video-time')[0]).text()
                    };
                    if (!v.title) {
                        console.log('search title missing');
                        debugger;
                    }
                    if (type == 'first') {
                        sss.sug.push(v)
                    }
                    else {
                        vn.sug.push(v);
                        allvids.push(v);
                    }
                });
                if (type != 'first' || searchsongs.length >= searchsongsexpected) {
                    if (type == 'first' && searchsongs.length >= searchsongsexpected) {
                        searchsongsexpected = 0;
                        var vn = {
                            id: getVidId(searchsongsbase),
                            link: '',
                            img: '',
                            title: searchsongsbase,
                            type: 'search',
                            desc: searchsongsbase
                        };
                        vn.sug = []
                        allvids.push(vn);
                        for (var i = 0; i < searchsongs.length; i++) {
                            if (searchsongs[i].sug.length > 0) {
                                for (var i1 = 0; i1 < searchsongs[i].sug.length; i1++) {
                                    var sv = searchsongs[i].sug[i1];
                                    if (!vidExists(sv, 'all')) {
                                        sv.id = getVidId(sv.link);
                                        vn.sug.push(sv);
                                        allvids.push(sv);
                                        break;
                                    }
                                }
                            }
                        }
                    }
                    sortSuggestions();
                    showSuggestionsPanel();
                    $('.genere, .tabs').remove();

                    ui();
                }
            });
        }

        function getVidId(l) {
            return new Date().valueOf() + ++vididcounter;
        }

        function vidExists(v, t) {
            if (!t) t = 'up';
            if (v.link.split('=')[1] == basekey) return true;
            for (var i = (t = 'recent' ? allvids.length - 100 : 0); i < allvids.length; i++) {
                if (i < 0) continue;
                if (allvids[i].link == v.link) {
                    if (t == 'up' && v.type == 'up' && allvids[i].type == 'sug') {
                        $('#' + allvids[i].id).remove();
                        allvids.splice(i, 1);
                    }
                    else return true;
                }
            }
            return false;
        }

        function durationSeconds(hms) {
            var a = hms.split(':'); // split it at the colons
            var seconds;
            if (a.length == 3)
                seconds = (+a[0]) * 60 * 60 + (+a[1]) * 60 + (+a[2]);
            else
                seconds = (+a[0]) * 60 + (+a[1]);
            return seconds;
        }

        function sortSuggestions() {
            for (var i = 0; i < allvids.length; i++) {
                transitiond = i / allvids.length * 10;
                if (allvids[i].ui) continue;
                if (allvids[i].sug && allvids[i].sug.length > 0) {
                    var good = [],
                        bad = [];
                    for (var i1 = 0; i1 < allvids[i].sug.length; i1++) {
                        var v = allvids[i].sug[i1];
                        if (isGoodVideo(v)) good.push(v);
                        else bad.push(v);
                    }
                    if (bad.length > 0 && good.length > 0) good.push({
                        type: 'devider',
                        title: 'devider',
                        img: ''
                    });
                    allvids[i].sug = good.concat(bad);
                }
            }
        }

        function isGoodVideo(v) {
            var dur = durationSeconds(v.dur);
            var lv = v;
            if (playlists.settings.starred.star1.filter(function(a) {
                    return a.link == lv.link
                }).length > 0) return false;
            if (playlists.settings.starred.star2.filter(function(a) {
                    return a.link == lv.link
                }).length > 0) return false;
            if (playlists.settings.starred.star3.filter(function(a) {
                    return a.link == lv.link
                }).length > 0) return true;
            if (playlists.settings.starred.star4.filter(function(a) {
                    return a.link == lv.link
                }).length > 0) return true;
            if (playlists.settings.starred.star5.filter(function(a) {
                    return a.link == lv.link
                }).length > 0) return true;

            return (isGoodTitle(v.title) &&
                ((typeof dur == 'undefined' || !dur || isNaN(dur)) || (dur >= playlists.settings.optimalLength.from && dur <= playlists.settings.optimalLength.to)));
        }

        function isGoodTitle(q) {
            q = q.toLowerCase().trim();
            if (!(
                    // q.indexOf(' live')==-1 ||
                    q.indexOf('channel') == -1 && q.indexOf('playlist') == -1 && q.indexOf('[private video]') == -1 && q.indexOf('[deleted video]') == -1
                )) return false;
            for (var i = 0; i < playlists.settings.excludes.length; i++) {
                if (q.indexOf(playlists.settings.excludes[i]) > -1) return false;
            }
            return true;
        }

        function dataCookieToString(dataCookie) {
            var t = "";
            for (var x = 0; x < dataCookie.length; x++) {
                t += ((t != "") ? "; " : "") + dataCookie[x].key + "=" + dataCookie[x].value;
            }
            return t;
        }

        function mkdataCookie(cookie) {
            var t, j;
            cookie = cookie.toString().replace(/,([^ ])/g, ",[12],$1").split(",[12],");
            for (var x = 0; x < cookie.length; x++) {
                cookie[x] = cookie[x].split("; ");
                j = cookie[x][0].split("=");
                t = {
                    key: j[0],
                    value: j[1]
                };
                for (var i = 1; i < cookie[x].length; i++) {
                    j = cookie[x][i].split("=");
                    t[j[0]] = j[1];
                }
                cookie[x] = t;
            }

            return cookie;
        }

        function getList(hr) {
            req.get({
                url: "https://www.youtube.com/" + hr + '&spf=navigate',
                headers: hdrs
            }, function(err, resp, body) {
                if (err) {
                    //document.getElementById('stage').innerHTML += ('<div class="error">' + err + '</div>');
                    console.log('ERR: ' + err);
                    setTimeout('researchInProgress=false;', 2000);
                    return;
                }
                var jr = resp; //JSON.parse(body);
                var listjq = cheerio.load(jr[3].body['player-playlist']);

                var listvids = listjq.find('li.yt-uix-scroller-scroll-unit');
                var listvn;
                var listind = 0;
                var jq = cheerio.load('');
                listvids.each(function() {
                    var l = $($(this).find('a')[0]).attr('href').split('&')[0];
                    var listv = {
                        id: getVidId(l),
                        basevidid: curbasevid.id,
                        subvidid: cursubvid ? cursubvid.id : null,
                        link: l,
                        img: $(this).find('[data-thumb]').attr('data-thumb') || $(this).find('[src]').attr('src'),
                        title: $($(this).find('a')[0]).attr('title') || $(this).find('.title').html() || $(this).find('h4').html().trim(),
                        type: listind == 0 ? 'list' : 'sug',
                        desc: 'Suggested for: ' + basevidtitle,
                        dur: $($(this).find('.accessible-description,.video-time')[0]).text().replace('- Duration: ', '').replace('.', '').trim(),
                        views: $($(this).find('.view-count')[0]).text().split(' ')[0]
                    };

                    if (!vidExists(listv, 'all') && listv.title) {
                        allvids.push(listv);
                        if (listvn) listvn.sug.push(listv);
                        if (listind == 0) {
                            listvn = listv;
                            listv.sug = []
                        };
                        listind++;
                    }
                })
                ui();
                researchInProgress = false;
            });
        }

        function probe(key, depth, buffup, probedepth) {
            probing = true;
            depth = depth || 0;
            if (!key || key.indexOf('undefined') > -1) {
                debugger;
            }
            req.get({
                    url: "https://www.youtube.com/watch?v=" + key,
                    //	headers: hdrs
                },
                function(err, resp, body) {
                    try {
                        if (err) {
                            console.log('ERR: ' + err);
                            if (buffup) buffUp(buffup);
                            setTimeout('researchInProgress=false;', 2000);
                            return;
                        }
                        ref = "https://www.youtube.com/watch?v=" + key;

                        var jq = cheerio.load(body);

                        var vids = jq.find('.video-list').find('.content-wrapper');
                        try {

                            basevidtitle = //jq.find('.watch-title ')[0].children[0].data.trim();
                                jq.find('.watch-title ').text();
                            if (basevidtitle.trim() == '')
                                debugger;
                        }
                        catch (e) {
                            debugger;
                        }

                        var lists = jq.find('.video-list').find('a.related-playlist').first();

                        if (!buffup)
                            lists.each(function() {
                                var hr = $(this).attr('href');
                                researchQueue.unshift({
                                    type: 'list',
                                    url: hr
                                })
                            })


                        var ind = 0;
                        var np = '';
                        var vn;
                        var nn = '';
                        var buffed = false;
                        vids.each(function() {
                            if (buffup && ind > 0) {
                                return;
                            }
                            if ($(this).next().attr('class') == 'thumb-wrapper') {
                                var l = $($(this).find('a')[0]).attr('href');
                                var v = {
                                    id: getVidId(l),
                                    basevidid: curbasevid.id,
                                    subvidid: cursubvid ? cursubvid.id : null,
                                    link: l,
                                    img: $(this).next().find('[data-thumb]').attr('data-thumb'),
                                    title: $($(this).find('a')[0]).attr('title'),
                                    type: ind == 0 ? 'up' : 'sug',
                                    desc: 'Suggested for: ' + basevidtitle,
                                    dur: $($(this).find('.accessible-description,.video-time')[0]).text().replace('- Duration: ', '').replace('.', '').trim(),
                                    views: $($(this).find('.view-count')[0]).text().split(' ')[0]
                                };
                                if (!v.title) {
                                    console.log('probe title missing');
                                    debugger;
                                }

                                vidExists(v, 'up');
                                if ($('#queue .vidui[data-link="' + v.link + '"]').length > 0 || !isGoodVideo(v)) {
                                    if (buffup) {
                                        ind++;
                                        buffUp(buffup);
                                        buffed = true;
                                        return;
                                    }
                                    //debugger;
                                    if (ind == 0) {
                                        console.log('guessing - ' + ($('#queue .vidui[data-link="' + v.link + '"]').length > 0 ? 'existed ' : 'not good ') + v.title);
                                        return;
                                        v = getVidSug();
                                        if (v) {
                                            np = v.link.split('=')[1];
                                            v.type = 'up';
                                            v.sug = []
                                            vn = v;
                                        }
                                    }
                                }
                                else {
                                    if (ind == 0) {
                                        np = $($(this).find('a')[0]).attr('href').split('=')[1];
                                        nn = v.title;
                                        v.type = 'up';
                                        v.sug = []
                                        vn = v;
                                    }
                                    else if (buffup) {
                                        ind++;
                                        return;
                                    }
                                    else if (vn) {
                                        vn.sug.push(v);
                                    }
                                    ind++;
                                    allvids.push(v);
                                }
                            }
                        });
                        if (depth >= probedepth && vn && vn.type == 'up') vn.type = 'list';
                        ui();
                        if (buffup) {
                            setTimeout('researchInProgress=false;', 1000);

                            return;
                        }

                        if (vids.length > 0 && nn != '' && depth < probedepth) {
                            if (vn) cursubvid = vn;
                            // {
                            //     id: getVidId('v=' + basekey),
                            //     link: 'v=' + basekey,
                            //     img: '',
                            //     title: nn,
                            //     type: 'root',
                            //     root: depth + 2,
                            //     sug: []
                            // };
                            //allvids.push(cursubvid);
                            //setTimeout('probe("' + np + '",' + (depth + 1) + ')', 500);
                            researchQueue.unshift({
                                type: 'probe',
                                url: np,
                                depth: (depth + 1),
                                probedepth: probedepth
                            });
                        }
                        else {
                            lastUpNext = np;
                            window.lastditributed = false;
                            probing = false;
                            checkProbe();
                            //progress(100);
                        }
                    }
                    catch (ep) {
                        console.log('probe error');
                        debugger;
                    }

                    setTimeout('researchInProgress=false;', 1000);


                });
        }

        function getVidSug() {
            for (var i = 0; i < allvids.length; i++) {
                var v = allvids[i];
                if (allvids[i].type == 'sug' && !allvids[i].wassug && isGoodVideo(v) && $('#queue .vidui[data-link="' + allvids[i].link + '"]').length == 0) {
                    allvids.splice(i, 1)
                    allvids.push(v);
                    v.wassug = true;
                    return v;
                }
            }
        }

        function ui() {
            if (isDragging) {
                setTimeout(ui, 1000);
                return;
            }

            if ($('#stage iframe').length > 0) $('#stage').html('');
            inspoint = $('.insetpoint');
            if (inspoint.length == 0) {
                $('<div class="insetpoint"><div class="or-spacer"><div class="mask"></div><span><i>Insert point</i></span></div></div>').prependTo('#queue');
                inspoint = $('.insetpoint');
            }
            //$('.genere, .tabs').remove();

            var h = '';
            var hq = '';
            var newqids = [];
            transitiond = 0;
            addedvis = false;
            addedinvis = 0;
            for (var i = 0; i < allvids.length; i++) {
                transitiond = i / allvids.length * 10;
                if (allvids[i].ui) continue;
                allvids[i].ui = true;



                if (allvids[i].root <= 2 && allvids[i].title != 'initial') {
                    //if (allvids[i].root==2)h+='<div class="searchheader slidein" style="margin-left: -4px;">Related to: '+allvids[i].title+'</div>';
                    //else if(i<+allvids.length-1)
                    //h+='<div class="searchheader slidein">Related to: '+allvids[i].title+'<div onclick="deleteAllVid('+allvids[i].id+');" class="delsearch del"></div></div><div class="spacer"></div>';
                }
                if (allvids[i].sug && allvids[i].sug.length > 0) {
                    if (allvids[i].desc.indexOf('Genere:') == 0) {
                        lasttitle = allvids[i].desc;
                        h += '<div class="searchheader slidein searchtitle" style="display: inline-block;" >' + allvids[i].desc + '<div class="delsearch del" onclick="deleteSegment(this)"></div></div><div class="spacer"></div>';
                    }
                    else if (allvids[i].type == 'search') {
                        lasttitle = allvids[i].desc;
                        h += '<div class="searchheader slidein searchtitle" style="display: inline-block;" >Search: ' + allvids[i].title + '<div class="delsearch del" onclick="deleteSegment(this)"></div></div><div class="spacer"></div>';
                    }
                    else if (allvids[i].sug && allvids[i].sug.length > 0) {
                        lasttitle = allvids[i].desc;
                        h += '<div class="searchheader slidein searchtitle" >' + allvids[i].desc + '<div onclick="deleteSegment(this);" class="delsearch del"></div></div><div class="spacer"></div>';
                    }
                }
                if (allvids[i].type == 'up' || allvids[i].type == 'search' || allvids[i].type == 'list' || allvids[i].type == 'root') {
                    if (typeof allvids[i].sug!='undefined' && allvids[i].sug.length > 0) {
                        var wrapped = false,
                            devided = false;
                        var rowvids = 8;
                        var ha = [];
                        for (var i1 = 0; i1 < Math.ceil(allvids[i].sug.length / rowvids); i1++) ha.push('<div class="sortcontainer suglist slidein" ' + ((allvids[i].type == 'search' || $('.suglist').length == 0 || true) ? ' shown="true" style="display:block;display: flex;"  ' : '') + '>');
                        for (var i1 = 0; i1 < allvids[i].sug.length; i1 += ha.length) {
                            for (var i2 = 0; i2 < ha.length; i2++) {
                                if (allvids[i].sug.length > i1 + i2) {
                                    var th = uivid(allvids[i].sug[i1 + i2], 'sug', devided);
                                    if (allvids[i].sug[i1 + i2].type == 'devider') {
                                        for (var i3 = 0; i3 < ha.length; i3++) {
                                            ha[i3] += th;
                                        }
                                        devided = true;
                                    }
                                    else
                                        ha[i2] += th;
                                }
                            }

                            if ((allvids[i].type == 'search' || $('.suglist').length == 0)) addedvis = true;
                            else addedinvis++;

                        }
                        for (var i1 = 0; i1 < ha.length; i1++) {
                            ha[i1] += '</div>';
                            h += ha[i1];
                        }

                    }
                    if (allvids[i].type == 'up') {

                        hq += uivid(allvids[i], 'list');
                        if (addMode !== 'add')
                            addInfo(delspan.replace('@id', allvids[i].id) + ' ' + allvids[i].title);
                        newqids.push(allvids[i].id);
                    }
                }
            }
            if (h != '') $('.genere, .tabs').remove();
            if (!statichtml) $(h).appendTo('#stage');
            if (hq != '') {
                var jq = $(hq);
                if (addMode == 'distribute') {
                    if (window.lastditributed) {
                        var al = window.lastditributed.next().next().next()[0] || $('#queue .vidui').last()[0];
                        jq.insertAfter(al)
                        window.lastditributed = $(al).next();
                    }
                    else {
                        var al = $(inspoint).next() || $(inspoint).first();
                        if (al.length > 0) {
                            jq.insertAfter(al)
                            window.lastditributed = al.next();
                        }
                        else {
                            jq.prependTo('#queue');
                            window.lastditributed = jq.next() || jq;
                        }
                    }
                    jq.slideDown();
                }
                else if (addMode == 'distribute')
                    $(jq).appendTo('#queue');
                else
                    $(jq).insertAfter(inspoint);
            }

            $("#queue").sortable({
                axis: "y",
                start: function() {
                    isDragging = true;
                },
                stop: function() {
                    isDragging = false;
                    resize();
                }
            });
            $(".suglist").sortable({
                connectWith: "#queue",
                items: '.vidui:not(.devider)',
                start: function() {;
                    $('#smiley').appendTo('body');
                    isDragging = true;
                    $('#scrollspace').css('overflow', 'visible');
                },
                stop: function() {
                    isDragging = false;
                    $('#scrollspace').css('overflow', 'auto');
                    resize();
                }
            });
            $(".sortcontainer").disableSelection();
            resize();
            var e = $('.sugmore').first();

            if (e[0].countsug) e[0].countsug += addedinvis;
            else e[0].countsug = addedinvis;
            if (new Date() - lastatt > 5500) {
                e.removeClass('attention').addClass('attention', 100);
                lastatt = new Date();
            }

            setHeaders(true);
            setTimeout(function() {
                $('.popin').removeClass('popin');
                $('.slidein').removeClass('slidein');
                setHeaders();
            }, 100);
        }

        function uivid(v, t, postdevided) {
            if (v.type == 'devider') {
                var h = '<div class="devider"></div>';
                return h;
            }
            var h = '<div data-link="' + v.link + '" style="' + (postdevided ? 'opacity:.73;    -webkit-filter: grayscale(1);    background: none;' : '') + ';min-width:' + Math.min(350, 256 + (v.title.length - 50) * 2 + 25) + 'px;    white-space: nowrap;' + vidColor(v) + ';" valign="top" class="vidui popin" id="' + v.id + '" onclick="clicked(' + v.id + ',\'' + t + '\',this,\'main\')">';
            h += '<table style="width: 100%;" cellspacing="0" cellpadding="0"><tr><td width="10"><img class="vidimgui" src="https://' + v.img.replace('https://', '') + '"> ';//.replace('.webp','.jpg').replace('_webp/','/') 
            h += '</td><td ><div class="title" >' + (window.newlistener && typeof window.firsttrack == 'undefined' ? 'Click this track to get the party started!!' : v.title) + '</div></td></tr></table>';
            if (v.dur && v.dur != '3:33') h += '<span class="vidtimeui" >' + v.dur + '</span> ';
            h += '<div class="tools">';
            h += '<span class="toolph""></span>';
            h += '<span class="delall tool" title="delete this and all next videos" onclick="deleteAllVid(' + v.id + ');return false;"></span>';
            h += '<span class="del tool" title="delete this video" onclick="deleteVid(' + v.id + ');return false;"></span>'
                //h += '<span class="delwiz tool" title="delete anything like this video" onclick="deleteVid(' + v.id + ',true);return false;"></span>'
            h += '<span class="addwiz tool"  title="add this video and more videos like it" onclick="clicked(' + v.id + ',\'' + t + '\',this.parentNode.parentNode,\'addwiz\');return false;"></span>'
            h += '<span class="addtop tool" title="play this video next" onclick="addTop(' + v.id + ',\'' + t + '\',this.parentNode.parentNode);return false;"></span>'
            h += '<span class="addbottom tool" title="add this video last" onclick="addBottom(' + v.id + ',\'' + t + '\',this.parentNode.parentNode);return false;"></span>'
                //h += '<span class="playnext tool" title="play this next" onclick="addTop(' + v.id + ',\'' + t + '\',this.parentNode.parentNode);return false;"></span>'
                //h += '<span class="skipto tool" title="skip to this" onclick="clicked(' + v.id + ',\'' + t + '\',this.parentNode.parentNode);return false;"></span>'
            h += '</div></div>';
            window.firsttrack = true;
            return h;
        }

        function showSuggestions(depth, fromscorll) {

            $("#scrollspace").animate({
                scrollTop: $("#scrollspace").scrollTop() + $(window).height() - 150
            });


        }

        function peekSuggestions(go) {}

        function vidColor(v) {
            if (v.basevidid && !v.root) {
                var v1 = getVidById(v.basevidid);
                if (v1) {
                    while (!v1.colors && v1.basevidid && v1.type != 'root') v1 = getVidById(v1.basevidid);
                    return 'display: inline-block;nbackground-image:  ' + v1.colors.replace(',1)', ',.4)').replace(',1)', ',.4)') + ');border-radius: 0 8px 8px 0;border-right:4px solid rgba' + v1.colors.split('rgba')[2].replace(',1)', ',.9)') + ';border-bottom:0px solid rgba' + v1.colors.split('rgba')[2].replace(',1)', ',.0)') + ';';
                    return 'background-image:  ' + v1.colors.replace(',1)', ',.7)').replace(',1)', ',.7)') + ');'
                }

            }

            return 'background-image: linear-gradient(to bottom left, rgb(234, 234, 234), #8E8E8E);'
        }

        function addTop(id, t, elm) {
            $(elm).slideUp('fast', function() {
                $(this).insertBefore(inspoint).slideDown()
            });
            //$("#queue").animate({ scrollTop: 0 }, "slow");
            event.preventDefault();
            event.cancelBubble = true;
            return false;
        }

        function addBottom(id, t, elm) {
            $(elm).slideUp('fast', function() {
                $(this).appendTo('#queue').slideDown();
            });
            $("#queue").animate({
                scrollTop: $("#queue")[0].scrollHeight
            }, "slow");
            event.preventDefault();
            event.cancelBubble = true;
            return false;
        }

        function deleteSegment(helm) {
            var j = $(helm).parent().next();
            //debugger;
            var i = 10;
            while (i-- > 0 && !j.is('.searchheader')) {
                j.slideUp('fast', function() {
                    $(this).remove();
                });
                j = j.next();
            }
            $(helm).parent().remove();
        }

        function deleteVid(id, related) {
            var v = getVidById(id);
            if ($('#' + id).is('.playing')) playNext();
            if (related) {
                if ($('#' + id).parent().is('#queue')) {
                    var bid = v.root ? v.id : v.basevidid;
                    $('.suglist, #queue').children().each(function() {
                        var cv = getVidById($(this).attr('id'));
                        if (cv.basevidid == bid) {
                            $('#' + cv.id).slideUp({
                                duration: 300,
                                complete: function() {
                                    $(this).remove()
                                },
                                queue: false
                            });
                        }
                    });
                }
                else {
                    var helm = $('#' + id).parents('.suglist').prev();
                    var i = 10;
                    while (i-- > 0 && !helm.is('.searchheader') && helm.prev().length > 0) helm = helm.prev();
                    if (helm.is('.searchheader'))
                        deleteSegment(helm.find('.delsearch')[0]);
                }
            }
            $('#' + id).slideUp({
                duration: 300,
                complete: function() {
                    $(this).remove()
                },
                queue: false
            });
            event.preventDefault();
            event.cancelBubble = true;
            return false;
        }

        function deleteAllVid(id) {
            var v = getVidById(id);
            //debugger;
            if ($('#' + id).parents('.suglist').length > 0)
                $('#' + id).parents('.suglist').slideUp({
                    duration: 300,
                    complete: function() {
                        $(this).remove()
                    },
                    queue: false
                });
            else {
                $('#' + id).nextAll().slideUp({
                    duration: 300,
                    complete: function() {
                        $(this).remove()
                    },
                    queue: false
                });
                $('#' + id).remove();
            }
            event.preventDefault();
            event.cancelBubble = true;
            return false;
        }

        function resize() {
            return;
            $('#queue').height($('#queue')[0].scrollHeight)
            if ($('#queue').height() > $('#stage').height()) $('body').css('height', window.innerHeight + $('#stage').height() - 96 * 2);
            else $('#queue').height($('#stage').height() + 96 * 2);

        }

        function reportNext() {
            return;
            if ($('#queue .vidui').length == 0) return;
            var id = $(inspoint).next().attr('id');
            var v = getVidById(id);
            //ipcRenderer.send('online-status-changed', 'next:' + v.link.split('?v=')[1]);

        }

        function clicked(id, t, elm, main) {
            inspoint = $('.insetpoint');
            if (inspoint.length == 0) {
                $('<div class="insetpoint"><div class="or-spacer"><div class="mask"></div><span><i>Insert point</i></span></div></div>').prependTo('#queue');
                inspoint = $('.insetpoint');
            }
            if (elm.parentNode.id == 'queue') {
                if (main == 'main')
                    moveTo(id, elm);
                else if (main == 'addwiz') {
                    window.probedepth = 4;
                    var v = getVidById(id);
                    starred(v, 5);
                    basekey = v.link.split('=')[1];
                    probemain(v);
                    resize();
                }
            }
            else {
                var lid = id,
                    lelm = elm;
                var v = getVidById(id);
                if (!elm.hoverscore) elm.hoverscore = window.lastrateing;
                window.lastclickedrating = elm.hoverscore;
                switch (elm.hoverscore) {
                    case 0:
                        {
                            window.probedepth = 4;
                            starred(v, 5);
                            $(elm).slideUp('fast', function() {
                                $(this).insertBefore(inspoint).slideDown();
                                $('#smiley').appendTo('body');
                                if ($('.playing').length == 0) moveTo(lid, lelm);
                            });
                            basekey = getVidById(id).link.split('=')[1];
                            probemain(v);
                            resize();
                            //addToList(id);
                            break;
                        }
                    case 1:
                        {
                            window.probedepth = 2;
                            starred(v, 4);
                            $(elm).slideUp('fast', function() {
                                $(this).insertBefore(inspoint).slideDown();
                                $('#smiley').appendTo('body');
                                if ($('.playing').length == 0) moveTo(lid, lelm);
                            });
                            basekey = getVidById(id).link.split('=')[1];
                            probemain(v);
                            resize();

                            break;
                        }
                    case 2:
                        {
                            starred(v, 3);
                            window.probedepth = -1;
                            $(elm).slideUp('fast', function() {
                                $(this).insertBefore(inspoint).slideDown();
                                $('#smiley').appendTo('body');
                                if ($('.playing').length == 0) moveTo(lid, lelm);
                            });
                            basekey = getVidById(id).link.split('=')[1];
                            probemain(v);
                            resize();
                            break;
                        }
                    case 3:
                        {
                            starred(v, 2);
                            $(elm).slideUp('fast', function() {
                                $('#smiley').appendTo('body');
                                $(this).remove();
                            });
                            resize();
                            break;
                        }
                    case 4:
                        {
                            starred(v, 1);
                            $('#smiley').appendTo('body');
                            deleteVid(id, true)
                            resize();
                            break;
                        }
                    default:
                        {
                            $('#smiley').appendTo('body');
                        }
                }
            }
            event.preventDefault();
            event.cancelBubble = true;

        }

        function moveTo(id, elm) {
            if ($(elm).prevAll().length > 0) {
                var tl = $(elm).prevAll().length;
                playNext(id);
                checkProbe();
            }
            else {
                playNext(id);
            }

        }

        function probemain(basekey) {

            var v;
            var lcurbasevid;
            var lcurbasevid;
            if (typeof basekey.id != 'undefined') {
                basekey.root = true;
                basekey.colors = colors[colorind++ % colors.length];
                lcurbasevid = basekey
                $('#' + basekey.id).css({
                    'border-right': '4px solid',
                    'border-right-color': 'rgba' + basekey.colors.split('rgba')[2],
                    'nbackground-image': basekey.colors + ')'
                });
                basekey = basekey.link.split('=')[1];
            }
            else {
                lcurbasevid = {
                    id: getVidId('v=' + basekey),
                    link: 'v=' + basekey,
                    img: '',
                    title: 'initial',
                    type: 'root',
                    root: 1,
                    sug: []
                };
                allvids.push(lcurbasevid);
            }
            lcursubvid = lcurbasevid; // null;
            //probe(basekey);
            researchQueue.push({
                type: 'probe',
                url: basekey,
                depth: 0,
                probedepth: window.probedepth,
                curbasevid: lcurbasevid,
                cursubvid: lcursubvid
            })

            progress(Math.round(50 / (researchQueue.length + 2)));
        }
    </script>
    <div style="width:100%;height:100px;top: 22px;position:fixed; display:;   z-index:11;  overflow: auto;  box-shadow: inset 0px -4px 2px -3px;    padding-left: 305px;overflow:hidden; " class="metal">

        <div class="ui-widget" style="    margin-right: 342px;">
            <div id="maintools" style="text-align:right;    min-width: 610px;">
                <button onclick="stopVid()" style="float:left;margin-right: 0px;    border-radius: 0  0;line-height:26px;    width: 41px;margin-right: 6px;">Stop</button>
                <button onclick="playNext()" style="float:left;margin-right: 0px;border-radius: 0 0px 0px 9999px;line-height:26px;width: 25px;transform: rotateZ(45deg);height: 25px;position: absolute;left: 351px;top: 5px;"></button>
                <button onclick="clearSug()" style="float:left;margin-left: 38px;border-radius: 50px 0 0px 50px;text-align: right;width: 52px;margin-right: 2px; */">&#9836;
                    <br>Home</button>
                <button onclick="settings()" class="btnsettings" style="">Settings
                    <span style="font-size: 15px;top: 1px;position: absolute;left: 1px;height:16px;">&#9881;</span></button>

                <button onclick="help()" class="btnhelp" style="position: absolute;top: 19px;box-sizing: padding-box;">?</button>
                <span style="  float:right;  margin-right:-26px;text-align: left;font-size: 12px;line-height: 0;margin-top: -1px;color: black;">
        <span style="float: left;padding-top: 15px;display: block;">Playlists:</span>
                <button onclick="renameList()" style="border-radius: 50px;line-height: 7px;width: 64px;float: right;color:;margin-right:-4px;margin-top:8px">Rename</button>
                <button onclick="newList()" style="border-radius: 50px;line-height: 7px;width: 42px;float: right;margin-right: 5px;">New</button>
                <button onclick="saveList()" style="border-radius: 50px;line-height: 7px;width: 45px;float: right;margin-right: 5px;">Save</button>
                <button onclick="saveListAs()" style="x;border-radius: 50px;line-height: 7px;    width: 60px;float: right;margin-right: 5px;">Save as</button>
                <button onclick="deleteList()" style="x;border-radius: 50px;line-height: 7px;    width: 52px;float: right;margin-right: 5px;">Delete</button>
                <br>
                <select id="selplaylists" style="    margin-right: -4px;border-radius:10px;font-size: 11px;width: 387px;background-image: linear-gradient(to bottom, rgb(234, 234, 234), #8E8E8E);text-shadow: 1px 1px 0 rgba(255,255,255,0.26);color: #222;order: 1px groove #888;margin-top: 2px;height: 20px;padding: 0px 10px;">
                </select>
                </span>


                <table style="
            width: 100%;
            height: 50px;

        ">
                    <tbody>
                        <tr>
                            <td style="
            text-align: left;
        ">
                                <input id="q" tabindex="-1" placeholder="Search for artist name, song title, band ..." style="width:60vw;    font-size:17px;" class="ui-autocomplete-input ui-autocomplete-loading" autocomplete="off">
                            </td>
                            <td id="tdlabel" style="
            overflow: hidden;
            padding: 0;
            margin: 0;
        ">
                                <div class="clabel" style="    right: 42px;
    position: fixed;
    top: 65px;" id="clabel">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                            </td>
                        </tr>
                    </tbody>
                </table>



                <div class="progress">
                    <div class="progress-bar" style="display: none; width: 0%; background-color: rgb(242, 211, 27);"></div>
                </div>
            </div>
        </div>

        <script>
            function removeExclusion() {
                if ($('#selexclude option:selected').length == 0) return;
                var vals = $('#selexclude').val();
                for (var i = 0; i < vals.length; i++) {
                    var s = vals[i];
                    var s = $('#selexclude option[value="' + s + '"]').text();
                    $('#selexclude option[value="' + s + '"]').remove();
                    playlists.settings.excludes = $.grep(playlists.settings.excludes,
                        function(value) {
                            return value != s;
                        });
                }
                saveList(true, true);
            }

            function addExclusion() {
                $("#name").val('')
                $("#dialog").dialog({
                    autoOpen: true,
                    modal: false,
                    resizable: false,
                    title: 'Add track filter',
                    buttons: {
                        Ok: function() {
                            var name = $("#name").val();
                            if (name.length > 0 && $.inArray(playlists.settings.excluds, name)) {
                                playlists.settings.excludes.push(name);
                                $('#selexclude')
                                    .append($("<option></option>")
                                        .attr("value", name)
                                        .text(name));
                                saveList(true, true);

                            }
                            $('.ui-dialog label').html('Playlist Name')
                            $(this).dialog('close');
                        }
                    }
                });
                $('.ui-dialog label').html('Exclude tracks containing:')
            }

            function jsonList() {
                var a = []
                for (var i = 0; i < played.length; i++) {
                    a.push(vidToMinVid(played[i]));
                }
                $('#queue .vidui').each(function() {
                    var v = getVidById(this.id);
                    var tv=vidToMinVid(v);
                    v.type='up';
                    a.push(tv);
                });
                return a;
            }

            function vidToMinVid(v) {
                var nv = $.extend(true, {}, v);
                nv.ui = false;
                delete nv.basevidid;
                delete nv.sug;


                return nv;

                return {
                    link: v.link,
                    title: v.title,
                    img: v.img,
                    dur: v.dur
                }
            }

            function renameList() {
                $("#name").val(playlists.lists[curlistind].title)
                $("#dialog").dialog({
                    autoOpen: true,
                    modal: false,
                    resizable: false,
                    title: 'Rename playlist ...',
                    buttons: {
                        Ok: function() {
                                var name = $("#name").val();
                                if (name.length > 0) {
                                    playlists.lists[curlistind].title = name;
                                    saveList();
                                    var l = playlists.lists[curlistind];
                                    $('#selplaylists option[value="' + curlistind + '"]').text(name); // + ' (' + l.vids.length + ')');
                                }
                                $(this).dialog('close');
                            } //end function for Ok button
                    } //end buttons
                }); //.dialog('open');


            }

            function newList() {
                $("#name").val('')
                $("#dialog").dialog({
                    autoOpen: true,
                    modal: false,
                    resizable: false,
                    title: 'New playlist name...',
                    buttons: {
                        Ok: function() {
                            var name = $("#name").val();
                            if (name.length > 0) {
                                playlists.lists.push({
                                    title: name,
                                    vids: []
                                });
                                curlistind = playlists.lists.length - 1;
                                $('#queue .vidui').remove();
                                saveList();
                                var l = playlists.lists[curlistind];
                                window.holddefaults = true;
                                $('#selplaylists').append($('<option>', {
                                    value: curlistind,
                                    text: l.title //+ ' (' + l.vids.length + ')'
                                })).val(curlistind);
                                window.holddefaults = false;
                            }
                            $(this).dialog('close');
                        }
                    }
                });
            }

            function shuffleList() {
                progress(0);
                var a = []
                $('#queue .vidui').not('.playing').each(function() {
                    a.push(this);
                });
                if (a.length > 1) {
                    for (var i = 0; i < a.length; i++) {
                        $(a[i]).remove().insertAfter($('#queue .vidui')[Math.floor(Math.random() * (a.length - 1))]);
                    }
                }
                progress(100);
            }

            function saveList(skipchanges, skipui) {
                if (!skipui) progress(0);
                if (playlists.lists[curlistind]) {
                    if (!skipchanges) {
                        var l = jsonList();
                        for (var i = 0; i < l.length; i++) {
                            if (typeof l[i].friends != 'undefined') {
                                for (var i1 = 0; i1 < l[i].friends.length; i1++) {
                                    delete l[i].friends[i1].friends;
                                    delete l[i].friends[i1].sug;
                                }
                            }
                            if (typeof l[i].sug != 'undefined') {
                                for (var i1 = 0; i1 < l[i].sug.length; i1++) {
                                    delete l[i].sug[i1].friends;
                                    delete l[i].sug[i1].sug;
                                }
                            }
                        }
                        playlists.lists[curlistind].vids = l;
                        record('Saved List', playlists.lists[curlistind].title + ' (' + playlists.lists[curlistind].vids.length + ')');
                        if (playlists.lists[curlistind].title.indexOf(')') == 0) {
                            var rvids = [];
                            for (var i = 0; i < allvids.length; i++) {
                                var cv=allvids[i];
                                var nv = $.extend(true, {}, cv);
                                delete nv.sug;
                                if (nv.friends) {
                                    for (var i1 = 0; i1 < nv.friends.length; i1++) {
                                        delete nv.friends[i1].sug;
                                        delete nv.friends[i1].friends;
                                    }
                                }
                                rvids.push(nv);
                            }
                            $.post("record.ashx", {
                                act: 'Saved List pub'
                                , guid: playlists.settings.guid
                                , data: playlists.lists[curlistind].title
                                , vids: JSON.stringify(rvids)
                                , html: $('#stage').html().replace('&', ' ').split('<script>')[0] // $('.suglist').html()
                            })
                            .done(function (data) {
                                alert('page added');
                                //alert("Data Loaded: " + data);
                            });
                            
                        }
                    }
                    playlists.curlistind = curlistind;
                }
                else {
                    playlists.curlistind = Math.max(0, curlistind - 1);
                }

                for (var i = 1; i < 6; i++) {
                    if (typeof playlists.settings.starred['star' + i] != 'undefined') {
                        for (var i1 = 0; i1 < playlists.settings.starred['star' + i].length; i1++) {
                            delete playlists.settings.starred['star' + i][i1].friends;
                            delete playlists.settings.starred['star' + i][i1].sug;
                        }
                    }
                }

                fs.writeFile(window.userDataDir + "/lists.txt", JSON.stringify(playlists), function(err) {
                    if (err) {
                        return console.log(err);
                    }
                    if (!skipui) progress(100);
                });
            }
            var dialogmode = '';

            function saveListAs() {
                dialogmode = 'saveas';
                $("#name").val(playlists.lists[curlistind].title + ' copy')
                $("#dialog").dialog({
                    autoOpen: true,
                    modal: false,
                    resizable: false,
                    title: 'Save playlist as...',
                    buttons: {
                        Ok: function() {
                            var name = $("#name").val();
                            if (name.length > 0) {
                                playlists.lists.push({
                                    title: name,
                                    vids: []
                                });
                                curlistind = playlists.lists.length - 1;
                                saveList();
                                var l = playlists.lists[curlistind];
                                window.holddefaults = true;
                                $('#selplaylists').append($('<option>', {
                                    value: curlistind,
                                    text: l.title //+ ' (' + l.vids.length + ')'
                                })).val(curlistind);
                                window.holddefaults = false;
                            }
                            $(this).dialog('close');
                        }
                    }
                });
            }

            function deleteList() {
                if (playlists.lists.length > 1) {
                    playlists.lists.splice(curlistind, 1);
                    window.holddefaults = true;
                    $('#selplaylists option[value="' + curlistind + '"]').remove();
                    saveList();
                    curlistind = Math.max(0, curlistind - 1);
                    layoutLists();

                    window.holddefaults = false;
                }
            }

            function stopVid() {
                //ipcRenderer.send('online-status-changed', 'stop:');
                if (player.getPlayerState() != 2) {
                    player.pauseVideo();
                    ///$('button[onclick="stopVid()"]').html('Play').addClass('playbutton');
                }
                else {
                    player.playVideo();
                    //$('button[onclick="stopVid()"]').html('Pause').removeClass('playbutton');
                }
            }

            function clearSug() {
                showSuggestionsPanel();
                if ($('#stage').children(':not(.genere,.spacer,.sugmore)').length == 0 && $('#stage').children('.genere').length > 10) return;

                $('#stage').children().remove();
                $('#stage').css({
                    opacity: 1
                })
                setup(false);
            }

            function clearQueue() {
                for (var i = 0; i < allvids.length; i++) {
                    if (allvids[i].type = 'up') {
                        allvids[i].type = 'sug';
                        //allvids.splice(i, 1);
                        //i--;
                    }
                }
                $('#queue').parent().attr('lasttop', $('#queue').parent().css('top')).css('top', 90).css('background-size', '0px');
                $('#queue').css({
                    height: '100vh',
                    overflowY: 'hidden'
                });
                $('#queue .vidui').not(':in-viewport').css('visibility', 'hidden');
                $('body').jGravity({
                    target: '#queue .vidui:in-viewport',
                    ignoreClass: 'ignoreMe',
                    weight: 10,
                    depth: 5,
                    drag: false
                });

                setTimeout(function() {
                    $('#queue').children().remove();
                    $('#queue').css({
                        height: 'auto',
                        overflowY: 'auto'
                    });
                    $('#queue').parent().css({
                        backgroundSize: '100px',
                        top: $('#queue').parent().attr('lasttop'),
                        opacity: 1
                    })
                }, 1500);

                //$('#queue').html('');
            }
            var lastsearchtime = new Date();
            $(function() {
                $("#q").focus(function() {
                    $('#tdlabel').css({
                        "max-width": "0"
                    }).stop().fadeOut('fast'); //,display:'none'});
                    $('#q').css({
                        "width": $('#stage').width() - 32
                    });
                });
                $("#q").blur(function() {
                    $('#tdlabel').css({
                        "max-width": "200"
                    }).stop().fadeIn('slow'); //,display:'inline'});
                    $('#q').css({
                        "width": '60vw'
                    });
                });
                $("#q").autocomplete({
                        source: function(request, response) {
                            autocomplete(request.term, response);
                        },
                        minLength: 1,
                        select: function(event, ui) {
                            if (new Date() - lastsearchtime < 500) return;
                            lastsearchtime = new Date();
                            event.preventDefault();
                            if (ui.item) {
                                $('#stage').children().remove();
                                dosearch(ui.item.value);
                            }
                            return false;

                        }
                    })
                    .keydown(function(event) {
                        if (event.keyCode == 13) {
                            if ($("#q").val().length > 0) {
                                showSuggestionsPanel();
                                if (new Date() - lastsearchtime < 500) return;
                                $('.ui-autocomplete').hide();
                                $(".ui-menu-item").hide();
                                lastsearchtime = new Date();
                                $('#stage').children().remove();
                                dosearch($("#q").val());
                                event.preventDefault();
                                return false;
                            }
                        }
                    });;
            });
            var infid = 0;

            function removeInfo(infid) {
                if ($('#infos').css('max-height') == '23px')
                    $('#inf_' + infid).slideUp(400, function() {
                        $('#inf_' + infid).remove()
                    })
                else
                    setTimeout("removeInfo('" + infid + "')", 1000);
            }

            function addInfo(s) {
                infid++;
                if ($('#infos').css('max-height') == '23px')
                    $('<div id="inf_' + infid + '" style="display:none;"">' + s + '</div>').prependTo($('#infos')).slideDown();
                else
                    $('<div id="inf_' + infid + '" style="display:none;"">' + s + '</div>').appendTo($('#infos')).slideDown();
                //setTimeout("$('#inf_" + infid + "').slideUp(400,function(){$('#inf_" + infid + "').remove()})", 30000);
                setTimeout("removeInfo('" + infid + "')", 30000);
                if ($('#infos').children().length > 16) $('#infos').children().last().remove(); //.slideUp(400,function(){$(this).remove()});
            }
        </script>


        <span></span>
        <span id="currentlyplaying" style="display:none;padding:10px;"></span>
    </div>
    <div id="infos" style="width: 200px;position: fixed;right: 12px;z-index: 99;top: 119px;Ntransform: rotate(2deg);border-radius: 5px;"></div>
    <div class="queuetools metal">
        <button onclick="clearQueue()" style="float:left;border-radius: 0px 50px 50px 50px;width: 55px;margin: 6px 5px;text-align: right;margin-right: 5px;line-height: 26px;     text-align: center;">Clear</button>
        <button onclick="stopVid()" style="float:left;    border-radius: 0  0;line-height:26px;    width: 41px;margin: 6px 0;">Stop</button>
        <button onclick="playNext()" style="float:left;margin-right: 0px;border-radius: 0 0px 0px 9999px;line-height: 3px;width: 25px;transform: rotateZ(45deg);left: 108px;height: 25px;position: absolute;top: 3px;f;font-size: 12px;"></button>
        <button onclick="shuffleList()" style="float:left;border-radius: 50px 50px;width: 55px;margin: 6px 5px 0 36px;margin-right: 5px;line-height: 26px;text-align: center;">Shuffle</button>
        <button onclick="buffUp(10)" style="float:left;margin-right: 0px;border-radius: 0 0px 99999px 9999px;line-height: 12px;width: 46px;/* transform: rotateZ(45deg); */height: 32px;height: 36px;text-align: left;px;top: -2px;position: relative;padding: 5px;">Buff
            <br/>up</button>
        <button onclick="if(event.srcElement==this){$('#chkradio').prop('checked',!$('#chkradio').prop('checked')); checkProbe();return false;}" style="float:left;margin-right: 0px;border-radius: 99999px 9999px 0 0px;line-height: 12px;width: 46px;/* transform: rotateZ(45deg); */height: 32px;height: 36px;text-align: right;px;top: -2px;position: absolute;right: 3px;padding: 5px;">
            <input id="chkradio" type="checkbox" onclick="checkProbe()" style="margin-top: -2px;margin-right: -3px;" />Radio</button>
    </div>
    <div id="qcontainer" style="    direction: rtl;position: fixed;bottom: 49px;overflow-x: hidden;overflow-y: auto;z-index: 12;box-sizing: border-box;min-height: 0;top: 188px;box-shadow: inset -3px 0px 2px -3px, 3px -4px 2px -3px;">
        <div id="queue" style="position:relative" class="sortcontainer nmetal"></div>
    </div>
    <div id="logo" style="    perspective: 1100px;">
        <div id="logo_inner" style="width:100%;height:100%;    transform: rotateY( 0deg );
    transition: 1.5s;"></div>












    </div>
    <div id="scrollspace" style="z-index:13;overflow:auto;position:fixed;left:295px;top:121px;bottom:50px;right:0px;">
        <div id="stage" style="padding-top:20px;padding-left:10px;padding-bottom: 50px;">
            <div id="mnu" class="suglist"><div class="mnuitem">blues</div><div class="mnuitem">classical</div><div class="mnuitem">country</div><div class="mnuitem">disco</div><div class="mnuitem">electro house</div><div class="mnuitem">folk</div><div class="mnuitem">hip hop</div><div class="mnuitem">jazz</div><div class="mnuitem">latin</div><div class="mnuitem">metal</div><div class="mnuitem">paul mccartney</div><div class="mnuitem">pop</div><div class="mnuitem">reggae</div><div class="mnuitem">rhythm and blues</div><div class="mnuitem">rock</div><div class="mnuitem">world</div></div>
<!--stage-->

        </div>
        <div id="settings" class="hoverpanel" style="min-width: 600px; display: none; background-color: rgba(255, 255, 255, 0.239216);">
            <h1 style="position:relative;">Listricity Settings<div style="    position: absolute;
    right: -32px;
    width: 100px;
    height: 100px;
    background-color: rgba(255, 255, 255, 0.14);
    top: -30px;
    border-radius: 50%;
    box-shadow: 0 0 10px -2px;
    background-image: url(cog.png);
    background-position: center 19px;
    background-repeat: no-repeat;
    background-size: 76px;
    font-size: 1px;
    text-align: center;
    vertical-align: middle;
    line-height: 92px;"> </div></h1>
            <hr>
            <div style="line-height: normal;font-size: 20px;text-align: left;padding-bottom: 16px;">Listricity keeps track of your prefernces, the settings screen is where you can view and edit them</div>
            <h3>Suggestions flags</h3>
            <div style="line-height: normal;font-size: 20px;text-align: left;padding-bottom: 16px;">Listricity promotes tracks that match the following cryteria</div>

            <!--<h5>Optimal length</h5>-->

            <p>
                <label for="amount">Optimal track length:</label>
                <input type="text" id="amount" readonly style="    border: 0;
    color: #0E0E0E;
    font-weight: bold;
    font-size: 18px;
    background: none;
    width: 300px;
 text-align: right;
    float: right;">
            </p>

            <div id="slider-range-optimal-length"></div>
            <br/>
            <br/>

            <h3>Exclution flags</h3>
            <table>
                <tr>
                    <td style="    vertical-align: top;width: 40%;padding: 10px 40px 10px 0px;">
                        <div style="line-height: normal;font-size: 20px;text-align: left;padding-bottom: 16px;">Listricity exclude suggestion for tracks containing the following texts:</div>
                    </td>
                    <td>
                        <select multiple="multiple" style="
    width: 100%;
    height: 200px;
    font-size: 18px;
    font-family: sans-serif;
" id="selexclude"></select>
                        <div style="
    text-align: center;
    margin-top: 6px;
    background: none;
    box-shadow: none;" class="metal">
                            <button style="margin-right: 4px;" onclick="addExclusion()">Add</button>
                            <button onclick="removeExclusion()" class="" style="">Remove</button>
                        </div>
                    </td>
                </tr>
            </table>
            <br/>
            <br/>

            <h3>Star gradings</h3>
            <div style="line-height: normal;font-size: 20px;text-align: left;padding-bottom: 16px;">The tracks that you star are used to optimize the suggestions and additions made by Listricity. Here you can remove any wrongly starred tracks
            </div>

            <div id="starred">


            </div>





            <div style="height: 80vh;"></div>
        </div>





        <div id="help" class="hoverpanel" style="display: inline; min-width: 600px;    background-color: rgba(255, 255, 255, 0.44);">




            <div id="helpinit">

                <!--<div class="inittabs" style="background-color: black;-->
                <!--    width: 100%;-->
                <!--    position: fixed;-->
                <!--    top: 121px;-->
                <!--    left: 296px;-->
                <!--    box-shadow: 0 10px 100px 30px black;-->
                <!--"><div class="selected">Generes</div><div>Playlists</div><div>Explore</div><div>Trending</div></div>            -->
                <!--<br/><br/><br/>-->
                <nav>
                    <div>

                        <div style="    height: 90px;">
                            <h2>
                				<img src="listricitywhite2.png" style="    margin-left: -9px;">
                			</h2>

                        </div>
                    </div>
                </nav>
                <main>

                    <section>
                        <div>
                            <div>

                                <div>
                                    <h1>Wellcome to the Full-Featured Cloud-Based Online music player</h1>

                                    <p style="
    background-image: url(intuitive-icon.png);
    background-repeat: no-repeat;
    padding-left: 87px;
    background-size: 64px;min-height:75px;padding-top:10px;margin-top:-10px;
">
                                        Create and manage your playlists using a smart set of intuitive tools.
                                        <br>
                                        <br>
                                        Start a search or browse music genres
                                        <!--<a href="#" onclick="setup()" class="bluebutton">OK, Start the music!</a>-->
                                        <br>

                                    </p>
                                </div>

                            </div>






                            <a class="mnulink" href="/pop">
                            <div class="searchheadersticky slidein genere" 
                                 style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px;" 
                                 onclick="dosearch('pop music','genere');$('.genere, .tabs').remove();">
                                <span class="sprite" 
                                      style="background-position:-630px 5px;width:100px;height:100px; margin-right: 15px;"></span>Pop
                                <div class="dosearch searchtool"></div></div></a>
                            <a class="mnulink" href="/hip+hop"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('hip hop music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-840px 5px;width:100px;height:100px; margin-right: 15px;"></span>Hip hop<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/disco"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('disco music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-1050px 5px;width:100px;height:100px; margin-right: 15px;"></span>Disco<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/electro+house"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('electro house music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-1260px 5px;width:100px;height:100px; margin-right: 15px;"></span>Electro house<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/rhythm+and+blues"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('rhythm and blues music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-1470px 5px;width:100px;height:100px; margin-right: 15px;"></span>Rhythm and blues<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/latin"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('latin music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-1680px 5px;width:100px;height:100px; margin-right: 15px;"></span>Latin<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/country"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('country music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-1890px 5px;width:100px;height:100px; margin-right: 15px;"></span>Country<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/metal"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('metal music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-2100px 5px;width:100px;height:100px; margin-right: 15px;"></span>Metal<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/rock"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('rock music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-2310px 5px;width:100px;height:100px; margin-right: 15px;"></span>Rock<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/folk"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('folk music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-2520px 5px;width:100px;height:100px; margin-right: 15px;"></span>Folk<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/blues"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('blues music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-2730px 5px;width:100px;height:100px; margin-right: 15px;"></span>Blues<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/reggae"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('reggae music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-2940px 5px;width:100px;height:100px; margin-right: 15px;"></span>Reggae<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/jazz"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('jazz music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-3150px 5px;width:100px;height:100px; margin-right: 15px;"></span>Jazz<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/classical"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('classical music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-3360px 5px;width:100px;height:100px; margin-right: 15px;"></span>Classical<div class="dosearch searchtool"></div></div></a><a class="mnulink" href="/world"><div class="searchheadersticky slidein genere" style="white-space:nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin:20px 20px 0px 20px;cursor:pointer; display:inline-block;font-size:30px;padding:10px 15px 10px 30px; " onclick="dosearch('world music','genere');$('.genere, .tabs').remove();"><span class="sprite" style="background-position:-3570px 5px;width:100px;height:100px; margin-right: 15px;"></span>World<div class="dosearch searchtool"></div></div></a><div class="spacer"></div>
                            

                            <br />
                            <br />
                            <br/>




                            <div>
                                <div>
                                    <h2>
							All the tracks from the cloud. <br > and the smartest playlist tools
						</h2>
                                    <p>
                                        Listricity creates great playlists in minutes by making suggestions according to your searches and selections
                                        <br/>
                                        <br/>Manually drag and drop video suggestions into&nbsp;your&nbsp;playlist,
                                        <br/>
                                        <b>Or better yet!</b> tell Listricity how much you like (or dislike) a suggestion and have great playlists created for you.

                                        <br>
                                        <br>
                                        <a href="#" onclick="setup()" class=" bluebutton">Start listening now</a>
                                    </p>
                                    <div>
                                        <div>
                                            <div>
                                                <h2 style=""><br class="small-hide"> The&nbsp;world’s<br > smartest playlist builder.</h2>
                                                <p style="
    background-image: url(saas-icon.png);
    background-repeat: no-repeat;
    padding-left: 87px;
    background-size: 64px;
    padding-top: 10px;
    margin-top: -10px;
">

                                                    Listricity uses dozens of indicators, from the length of a track to the number of likes and views it received, in combination with the most advanced AI methodologies to bring the best suggestions to your searches.
                                                    <br> Once you made a few selections, and Listricity gets to know your taste, suggestions and automatic additions to&nbsp;your&nbsp;playlist will be tailor made, just for you.
                                                </p>
                                                <br/>
                                                <br/>
                                                <p style="" class="more-block"><a href="#" onclick="setup()" class="more bluebutton">Get Started</a></p>
                                                <br/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section>
                        <div>

                            <div class="column large-5 medium-6 small-12">
                                <div>
                                    <div>
                                        <h2 style="">Regain control over your playlists<br class="small-hide"></h2>
                                        <p style="">Listricity brings the variety of music from the cloud together with a set of powerful tools, all into a beautiful and interactive application
                                            <br>
                                            <br>Whether you like to search by artist, band, song name, or music genre, Listricity will be right there next to you reminding you of related beloved tracks</p>

                                        <p style=" " class="more-block"><a href="#" onclick="setup()" style="" class="bluebutton">Start now</a>
                                            <br/>
                                        </p>
                                    </div>
                                </div>
                            </div>

                        </div>











































                        <center style="       margin-bottom: -50px;
    height: 200px;">
                            <div>
                                <a href="mailto:hi@listricity.com?Subject=Hi%20Listrcicity" target="_blank" style="text-decoration: none;">
                                    <div class="share email">
                                    </div>
                                </a>
                                <div class="share facebook" onclick="window.open('https://www.facebook.com/Listricity-769355723196876/','share')">
                                </div>
                                <div class="share twitter" onclick="window.open('https://twitter.com/listricitymusic','share')">
                                </div>
                            </div>

                        </center>
                    </section>

                </main>

            </div>



            <h1 style="position:relative;">Meet Listricity<div style="position: absolute;right: -32px;width: 100px;height: 100px;background-color: rgba(255, 255, 255, 0.14);top: -30px;border-radius: 50%;box-shadow: 0 0 10px -2px;background-image: url(lg1.png);background-position: center;background-repeat: no-repeat;background-size: 86px;"></div></h1>
            <hr>
            <div style="line-height: normal;font-size: 20px;text-align: left;padding-bottom: 16px;">Listricity creates great playlists in minutes by making suggestions according to your searches and selections</div>
            <div style="background-image:url(arrarea.png);width: 100%;height: 332px;background-size: contain;background-repeat: no-repeat;text-align: center;line-height: 53px;font-size: 35px;padding-top: 147px;margin-bottom: 12px;box-sizing: border-box;background-position: center;min-width: 400px;"
            class="">Suggestions
                <br>Space


            </div>
            <div style="line-height: normal;font-size: 20px;text-align: left;">In the suggestions space you'll find video suggestions based on your recent actions.</div>
            <div style="background-image: url(arrleft.png);width: 100%;height: 150px;background-size: 230px;background-repeat: no-repeat;line-height: 25px;font-size: 35px;padding-left: 13vw;box-sizing: border-box;margin-top: 63px;margin-left: -43px;" class="">Playlist
                <br>
                <div style="line-height: normal;font-size: 20px;text-align: left;padding-top: 7vw;">You can drag and drop video suggestions into your playlist
                    <br>
                    <br>But better yet! you can tell Listricity how much you like (or disslike) a suggestion and let it do all the heavy lifting</div>
            </div>
            <div style="line-height: normal;font-size: 20px;text-align: left;margin-top: 124px;padding-bottom: 20px;">Here is how its done
                <br> When you hover your mouse over a suggestion, a set of tools pops up.
            </div>
            <div style="background-image: url(sug.png);width: 100%;height: 136px;background-repeat: no-repeat;line-height: 25px;font-size: 35px;box-sizing: border-box;" class="">
                <div style="height: 89px;"></div>
                <div style="line-height: normal;font-size: 20px;text-align: left;padding-top: 50px;">
                    Use the stars panel to express your feelings regarding a suggestion
                    <ul>

                        <li><b>5 Star</b>
                            <br>
                            <img src="5star.jpg" />
                            <br/>Adds the video to the playlist and many more vidoes like it</li>
                        <li><b>4 Star</b>
                            <br>
                            <img src="4star.jpg" />
                            <br/>Pretty good, add it and a few more</li>
                        <li><b>3 Stars</b>
                            <br>
                            <img src="3star.jpg" />
                            <br/>Well... add just this one</li>
                        <li><b>2 Star</b>
                            <br>
                            <img src="2star.jpg" />
                            <br/>Kinda bad - remove from suggestions and never add automatically<br/>
                        </li>
                        <li><b>1 Star</b>
                            <br>
                            <img src="1star.jpg" />
                            <br/>Sucks big time - don't show again</li>
                    </ul>
                </div>
            </div>
            <div style="height: 500px;"></div>
            <div style="line-height: normal;font-size: 20px;text-align: left;padding-bottom: 20px;">Listricity remembers your choices and tastes.
                <br>When suggestions are made or when the playlist is automatically buffed up, those preferences are used.</div>
            <div style="width: 100%; height: 150px; line-height: 25px; font-size: 35px; padding-left: 100px; box-sizing: border-box; margin-left: -43px; position: fixed; bottom: -500px; padding-top: 64px; display: ; background-image: url(&quot;arrbottomleft.png&quot;); background-size: 230px; background-repeat: no-repeat;"
            class="" id="helptoolsarrow">Playlist tools
                <br>

            </div>


            <div style="line-height: normal;font-size: 20px;text-align: left;margin-top: 100px;height: 400px;" id="helptools">At the bottom of the playlist youll find your playlist tools
                <br>
                <br>Clear the list, stop, play, or shuffle and...
                <div>
                    <div style="padding-left:280px;right:0;float: right;margin-top: 24px;">
                        <!--Buff up -->
                        <br>
                        <br>
                        <button onclick="" style="float:left;margin-right: 22px;border-radius: 0 0px 99999px 9999px;line-height: 12px;width: 46px; */height: 32px;height: 36px;text-align: left;px;top: -6px;position: relative;">Buff up</button> This button adds tracks to your playlist based on the current contents of it, and on your previous selections.
                        <br>
                        <br>
                        <!--Radio-->
                        <br>
                        <br>
                        <button style="float:left;margin-right: 22px;border-radius: 99999px 9999px 0 0px;line-height: 12px;width: 46px;height: 36px;text-align: right;px;top: -6px;right: 3px;" onclick="">
                            <input id="chkradio" type="checkbox" onclick="" style="margin-top: -2px;margin-right: -3px;">Radio</button>Checking the radio button automatically adds more tracks to the playlist when the last tracks are played.</div>

                </div>
            </div>


            <div style="line-height: 43px; font-size: 35px; box-sizing: border-box; margin-left: -43px; position: fixed; top: -500px; padding-top: 76px; right: 16px; height: 300px; text-align: left; width: 301px; padding-right: 111px; background-image: url(&quot;arrtopright.png&quot;); background-size: 230px; background-position: 100% 50%; background-repeat: no-repeat;"
            class="" id="helpsavearrow">&nbsp;&nbsp;&nbsp;Save it

                <br>

            </div>


            <div style="line-height: normal;font-size: 20px;text-align: left;margin-top: 200px;height: 400px;" id="savetools">
                <h1>Made a great playlist?</h1>
                <br/>
                <br/> On the top right you'll find
                <br/>everything you need in order to:
                <br/>
                <ul>
                    <li>Save your lists</li>
                    <li>Load them again</li>
                    <li>Rename a list</li>
                    <li>Duplicate a list</li>
                    <li>and Delete lists</li>
                </ul>
            </div>







            <div style="line-height: 40px; font-size: 35px; box-sizing: border-box; margin-left: -43px; position: fixed; top: -500px; padding-top: 38px; left: 356px; height: 300px; text-align: right; width: 404px; padding-right: 111px; background-image: url(&quot;arrupright.png&quot;); background-size: 122px; background-repeat: no-repeat;"
            class="" id="helpviewportarrow">Resizable
                <!--<br>&amp;-->
                <!--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                <!--<br>Detachable-->
                <br>Viewport
                <br>

            </div>

            <div style="line-height: normal;font-size: 20px;text-align: left;height: 400px;padding-left: 300px;" id="helpviewport">
                <h1>The viewport area is resizable</h1>
                <br>
                <br>Drag it to whatever size you want or use the icon on the top left to toggle between vew states.
                <br>
                <br>Double click for full screen
                <br>
                <br>And use the video controls, to set the volume and to seek to a point in the track.
                <!--And use the stay-op-top button to keep only the viewport on top of all other windows.-->
            </div>



            <hr>
            <h1>That's it!</h1> Click the
            <button onclick="clearSug()" style="top: -7px;position: relative;border-radius: 50px 0 0px 50px;text-align: right;width: 52px;margin-bottom: 2px; */">&#9836;
                <br>Home</button>
            button to start browsing geners or start a search on the search box
            <br> For advanced features and configurations click the
            <button onclick="settings()" class="btnsettings" style="    float: none;margin-right: auto;">Settings
                <span style="font-size: 15px;top: 0px;position: absolute;left: 1px;height:16px;">&#9881;</span></button> button.


            <div style="height:100px;"></div>
            <br>
            <br>
            <hr>
            <h1>Drop me a line</h1> Listricity is still young and relays on your input to keep improving
            <br>So please write an email to <a href="mailto:hi@listricity.com?Subject=Hi%20Listrcicity" target="_blank" style="text-decoration: none;    color: white;">hi@listricity.com</a> about any idea, requested feature, found bug, or anything else really.
            <br>
            <br>
            <div style="height:300px;"></div>


            <br>
            <br>
            <hr> Still here? ok, let’s do some
            <h1>Frequently Asked Questions</h1>
            <br>
            <div class="faqgroup">
                <span class="faqq">Q</span>What is the meaning of life?
                <br>
                <br>
                <span class="faqq">A</span>Hah! Easy, life is absolutely meaningless, next question.
            </div>
            <br>
            <div class="faqgroup">
                <span class="faqq">Q</span>If Spiderman and Superman were to fight, who would win?
                <br>
                <br>
                <span class="faqq">A</span>Good question! You see, Superman is an alien who can turn back time, so there's no match really.
            </div>
            <br>
            <div class="faqgroup">
                <span class="faqq">Q</span>Where is the music coming from?
                <br>
                <br>
                <span class="faqq">A</span>Wha… What … music in general you mean?
            </div>
            <br>
            <div class="faqgroup">
                <span class="faqq">Q</span>Waidaminute! are you writing those questions yourself?!?
                <br>
                <br>
                <span class="faqq">A</span>OK, out of time, enough questions for now, let’s do this again some time, ha?
            </div>
            <br>


            <div style="height:300px;"></div>

        </div>





    </div>
    </div>
    <div class="sugmore " onclick="showSuggestions()"><span class="downarrow"></span>Suggestions</div>
    <div width="292" height="193" style="position: fixed;top: 0px;margin-bottom:10px;left: 0px;width: 292px;height: 193px;display:none;box-shadow: 0 2px 2px 1px white,-1px 2px 1px 1px #333;">
    </div>
    <div id="dialog" title="" style="display:none">
        <div>
            <label>Playlist name:</label>
            <input id="name" name="name" type="text">
        </div>
    </div>
    <script>
        function settings() {
            $('#starred').html('');
            for (var i = 5; i > 0; i--) {
                $('#starred').append('<h3 style="    border-bottom: 3px groove #999;height: 35px;"><img src="' + i + 'star.jpg" style="    vertical-align: bottom;transform: rotate(-' + (i * 24 / 5 - 12) + 'deg);margin-left: -10px;margin-right: 10px;margin-top: 5px;"> Starred - ' + i + '</h3>');
                var h = '<div style="max-height:320px;overflow-y:auto;">';
                for (var i1 = 0; i1 < playlists.settings.starred['star' + i].length; i1++) {
                    var v = playlists.settings.starred['star' + i][i1];
                    h += '<div data-link="' + v.link + '" style="min-width:243px;white-space: nowrap;min-height: 96px;border: 1px solid;cursor:default;padding: 0;border-radius: 6px;background-color: #aaa;    display: inline-block;margin-right: 10px;margin-bottom:10px;" valign="top" class="vidui starred"><table style="width: 100%;" cellspacing="0" cellpadding="0"><tbody><tr><td width="10"><img class="vidimgui" src="https://' + v.img.replace('https://', '') + '" style="height: 96px;margin-right: 10px;border-radius: 5px 0 0 5px;border-right: 1px solid;">'
                    h += '</td><td><a href="#">' + v.title + '</a></td></tr></tbody></table>';
                    if (v.dur && v.dur != '3:33') h += '<span class="vidtimeui" >' + v.dur + '</span> ';
                    h += '<span class="del tool" title="" onclick="removeStarred(\'' + v.link + '\',' + i + ');$(this).parent().remove();return false;" style="right: 0;top: 0px;position: absolute;"></span></div>';


                }
                h += '</div>';
                $('#starred').append(h);
            }
            $('#canvas2').addClass('hoverstate');
            $('#help').fadeOut();
            $('#stage').fadeOut();
            $('#settings').fadeIn().css('display', 'inline-block');
        }

        function removeStarred(h, g) {
            for (var i = 5; i > 0; i--) {
                for (var i1 = 0; i1 < playlists.settings.starred['star' + i].length; i1++) {
                    var v1 = playlists.settings.starred['star' + i][i1];
                    if (v1.link == h) {
                        playlists.settings.starred['star' + i].splice(i1, 1);
                        i1--;
                    }
                }
            }
            saveList(true, true);

        }

        function help() {
            $('#starred').html('');
            $('#canvas2').addClass('hoverstate');
            $('#settings').hide();
            $('#stage').hide();
            $('#help').fadeIn().css('display', 'inline-block')
        }

        function showSuggestionsPanel() {
            $('#starred').html('');
            $('#canvas2').removeClass('hoverstate');
            $('#settings').fadeOut();
            $('#help').fadeOut();
            $('#stage').fadeIn();
        }

        function saveEQ(eq) {
            playlists.lists[curlistind].eq = eq;
            saveList(true, true);
        }

        function playNext(id) {
            $('#logo_inner').css({
                'transform': 'rotateY( 90deg )  scale(.1) ',
                'opacity': '0'
            });
            $('#logo').css({
                'background-size': '0px'
            });
            setTimeout("$('#logo_inner').css({'transform':'rotateY( 0deg )  scale(1)','opacity':'1'});$('#logo').css({'background-size':'0px'});", 2000);
            //debugger;
            checkProbe();
            if ($('#queue .vidui').length == 0) return;
            if (typeof id == 'undefined') id = $('#queue .vidui.playing').next().attr('id');
            if (typeof id == 'undefined' && $('#queue .vidui.playing').next().is('.insetpoint')) id = $('#queue .vidui.playing').next().next().attr('id');
            if (typeof id == 'undefined') id = $('#queue .vidui').not('.played, .playing').first().attr('id');
            if (typeof id == 'undefined') {
                $('#queue .vidui').removeClass('played').removeClass('playing');
                id = $('#queue .vidui').not('.played, .playing').first().attr('id');
            }
            if (typeof id == 'undefined') return;
            var v = getVidById(id);

            $('.playing').addClass('played').removeClass('playing');
            $('#queue #' + id).addClass('playing');

            var lid = id;
            setTimeout(function() {
                if ($('#logo').is('.logofullview')) {
                    $('#queue').parent().animate({
                        scrollTop: $('#' + lid).position().top - 47,
                    });
                }
                else {
                    $('#queue').parent().animate({
                        scrollTop: $('#' + lid).position().top - 47 - ($('#logo').height() - 166),
                    });
                }
            }, 1000);
            $('.insetpoint').insertAfter($('#' + id));

            setTimeout(function() {
                document.getElementById('currentlyplaying').innerText = v.title;
                document.title = v.title;
                $('#coverad').html('<img src="https://' + v.img.replace('https://', '') + '"/>' + v.title);
                $('.titlebar').html(v.title);
                //ipcRenderer.send('online-status-changed', 'play:' + v.link.split('?v=')[1]);

                if (!player) {
                    player = new YT.Player('logo_inner', {
                        height: '390',
                        width: '640',
                        origin: 'http://listricity/com',
                        videoId: v.link.split('?v=')[1],
                        playerVars: {
                            'autoplay': 1,
                            'controls': 1,
                            'autohide': 1,
                            'wmode': 'opaque',
                            'iv_load_policy': 3,
                            'modestbranding': 1,
                            'showinfo': 0,
                            'rel': 0
                        },
                        events: {
                            //'onReady': function(){debugger;event.target.playVideo();},
                            'onStateChange': onPlayerStateChange
                        }
                    });
                }
                else player.loadVideoById(v.link.split('?v=')[1], 0, "large")
                record('Play Track', v.title);
            }, 400);
        }

        function getVidById(id) {
            for (var i = 0; i < allvids.length; i++) {
                if (allvids[i].id == id) return allvids[i];
            }
            for (var i = 0; i < allvids.length; i++) {
                if (allvids[i].sug) {
                    for (var i1 = 0; i1 < allvids[i].sug; i1++) {
                        if (allvids[i].sug[i1].id == id) return allvids[i].sug[i1];
                    }
                }
            }
        }

        function checkProbe() {
            if (!$('#chkradio').prop('checked')) return;
            if ($('#queue .vidui.playing').length > 0) {
                if ($('#queue .vidui.playing').nextAll().length < 4) {
                    // if (0 && lastUpNext != '') {
                    //     probe(lastUpNext);
                    // }
                    // else 
                    {
                        //if (buffupcurdepth == 0) 
                        addMode = 'radio';
                        buffUp(4);
                        addMode = 'distribute';
                    }
                }
            }
        }


        function layoutCurList() {
            if (!statichtml)
                allvids = [];
            //else if(allvids.length>0) {
            //    allvids[0].type = 'up';
            //    allvids[0].sug = [];
            //    delete allvids[0].ui;
            //}
            $('#queue').children().remove();
            if (playlists.lists[curlistind] && !statichtml) {
                for (var i = 0; i < playlists.lists[curlistind].vids.length; i++) {
                    var v = playlists.lists[curlistind].vids[i];
                    v.type = 'up';
                    v.sug = [];
                    v.id = getVidId(v.link);
                    v.ui = false;
                    allvids.push(v);
                }
                //ipcRenderer.send('online-status-changed', 'eq:' + (playlists.lists[curlistind].eq || ''));

            }
            addMode = 'add';
            if(allvids.length>0) ui();
            //alert('layoutCurList'+allvide);
            addMode = 'distribute';
        }

        function layoutLists() {

            $('#selplaylists').children().remove();
            for (var i = 0; i < playlists.lists.length; i++) {
                var l = playlists.lists[i];
                $('#selplaylists').append($('<option>', {
                    value: i,
                    text: l.title // + ' (' + l.vids.length + ')'
                }));
            }
            //alert(curlistind);
            $('#selplaylists').val(curlistind);
                layoutCurList();
        }

        $('#selplaylists').change(function() {
            if (!window.holddefaults) {
                curlistind = $('#selplaylists').val();
                layoutCurList();
                saveList(true);
            }
        });


        function research() {
            if (researchQueue.length == 0 || researchInProgress) {
                if (!researchInProgress) {
                    if (iprogress != 0 && iprogress != 100) {
                        progress(100);
                        $('#queue .vidui').each(function() {
                            var v = getVidById(this.id);
                            for (var i2 = 0; i2 < allvids.length; i2++) {
                                if (allvids[i2].subvidid == v.id && !allvids[i2].friended) {
                                    if (!v.friends) v.friends = [];
                                    allvids[i2].friended = true;
                                    v.friends.push(allvids[i2]);
                                }
                            }
                        });
                    }



                }
                else {
                    progress(Math.round(Math.min(99, iprogress + (100 - iprogress) / (10 * Math.min(9, Math.max(1, (researchQueue.length)))))));
                }
                return;
            }
            researchInProgress = true;
            var job = researchQueue[0];
            researchQueue.splice(0, 1);
            switch (job.type) {
                case 'list':
                    {
                        getList(job.url);
                        break;
                    }
                case 'probe':
                    {
                        if (job.curbasevid) curbasevid = job.curbasevid;
                        if (job.cursubvid) cursubvid = job.cursubvid;
                        probe(job.url, job.depth, false, job.probedepth)
                        break;
                    }
                case 'buff':
                    {
                        probe(job.url, 0, job.depth, job.probedepth)
                        break;
                    }
            }

        }
        setInterval(research, 500);
    </script>

    </div>
    <script>
        var cs = ['ext', 'happy', 'mid', 'mad', 'fur'];
        var lastcs = cs[0];

        var fitimer = false;
        var fitimer1 = false;
        window.lastrateing = 1;
        window.lastclickedrating = 1;
        $(function() {
            if (document.location.href.indexOf('?os=w') > -1) {
                $('#qcontainer').addClass('windows');
                $('body').addClass('windows');
            }

            $("#slider-range-optimal-length").slider({
                range: true,
                min: 0,
                max: 5400,
                //values: [ playlists.settings.optimalLength.from, playlists.settings.optimalLength.to ],
                slide: function(event, ui) {
                    if (ui.values[1] - ui.values[0] < 240) return false;
                    $('#amount').val(getFromToTimeText(ui.values[0], ui.values[1]));
                }
            });
            var isChrome = !!window.chrome && !!window.chrome.webstore;

            $(document.body).on('mousemove', '#stage .vidui', function() {
                if (isDragging) {
                    clearTimeout(fitimer1);
                    fitimer1 = false;
                    clearTimeout(fitimer);
                    fitimer = false;
                    return;
                }
                var p;

                if ($('#smiley').length == 0) {
                    $('<div class="smiley-wrap" id="smiley" style=" ' + (isChrome ? 'right: -50px;' : 'width:0px;right: -15px;') + ';  display: block;top: -55px;border-color: rgb(75, 75, 75);"><div class="product-review-stars"><input type="radio" id="star5" name="rating" value="5" class="visuallyhidden" /><label for="star5" ntitle="Rocks! add this and many like it">★</label><input type="radio" id="star4" name="rating" value="4" class="visuallyhidden" /><label for="star4" ntitle="Pretty good, add it and a few more">★</label><input type="radio" id="star3" name="rating" value="3" class="visuallyhidden" /><label for="star3" ntitle="Well... add just this one">★</label><input type="radio" id="star2" name="rating" value="2" class="visuallyhidden" /><label for="star2" ntitle="Kinda bad - remove from suggestions">★</label><input type="radio" id="star1" name="rating" value="1" class="visuallyhidden" /><label for="star1" ntitle="Sucks big time - remove entire suggestion group">★</label></div><div class="head" style="' + (isChrome ? '' : 'display:none;visibility:hidden') + ';"><div class="eye pull-left"><div class="ball"></div></div><div class="eye pull-right"><div class="ball"></div></div></div><div class="smile"></div>').appendTo($('body'));
                    if (window.lastrateing) $('.visuallyhidden').attr('checked', false); //$('#star'+ ((5-window.lastrateing))).attr('checked', 'unchecked');
                }
                if ($('#smiley').parent()[0] != this && $('#smiley').parent().parent()[0] != this && $('#smiley').parent().parent().parent()[0] != this) {
                    if (fitimer) {
                        clearTimeout(fitimer);
                        fitimer = false;
                    }
                    $('#smiley').hide().delay(100).fadeIn('fast')
                        .appendTo($(this)); //.find('.ratetools'));
                    if (typeof window.lastclickedrating != 'undefined') {
                        if (typeof window.lastclickedrating != 'undefined') $('.visuallyhidden').attr('checked', false); //$('#star'+ ((5-window.lastclickedrating))).attr('checked', 'unchecked');
                        p = window.lastclickedrating;
                        this.hoverscore = window.lastclickedrating;
                    }
                }
                if (!$(event.srcElement).is('.tool')) {
                    if (!fitimer1)
                        fitimer1 = setTimeout(function() {
                            fitimer1 = false;
                            if (fitimer) {
                                clearTimeout(fitimer);
                                fitimer = false;
                            }
                            //$('#smiley').fadeIn('fast');
                        }, 300)
                    if (fitimer) clearTimeout(fitimer);
                    fitimer = setTimeout(function() {
                        //$('#smiley').fadeOut('slow');
                    }, 1500)
                }
                else {
                    clearTimeout(fitimer1);
                    fitimer1 = false;
                    clearTimeout(fitimer);
                    fitimer = false;
                    //$('#smiley').fadeOut('fast');
                }
                if ($(event.srcElement).parent().is('.product-review-stars')) {
                    clearTimeout(fitimer);
                    fitimer = false;
                    p = 4 - ($(event.srcElement).nextAll().length) / 2;
                    //if(p==0)p=5;

                    $('#smiley').find('.product-review-stars input + label').removeClass('active');
                }
                else {
                    p = window.lastclickedrating;
                }
                // else if(false){
                // 	var ll=event.x-$(this).position().left+$('body').scrollLeft();
                // 	p=Math.max(0,Math.min(cs.length-1,Math.floor((ll-18)/($(this).width())*5)));
                // 	p=4-p;
                // 	$('#smiley').find('.product-review-stars input + label').removeClass('active');
                // 	//for(var pn=0;pn<=p;pn++)
                // 	$('#smiley').find('.product-review-stars input + label:nth-of-type(n+'+(p+1)+')').addClass('active');
                // }
                //
                if (typeof p != 'undefined') {
                    this.hoverscore = p;
                    window.lastrateing = p;

                    //console.log(p+' '+ll+' '+$(this).width())
                    //ll-=58;
                    //ll=Math.max(-31,ll);
                    //ll=Math.min($(this).width()-76,ll);
                    //console.log(p);
                    $('#smiley').removeClass(lastcs)
                        .addClass(cs[Math.round(p)])
                        //.css({left:Math.min($(this).offset().left+$(this).width()-96,Math.max(event.clientX-58,$(this).offset().left))-6,top:$(this).offset().top-11})
                        .css({
                            right: -50,
                            top: -55
                                //, 'box-shadow': 'black 0px 0px 10px 0px, rgb(72, 72, 72) 0px 0px 22px 6px inset'
                                ,
                            'border-color': 'rgb(75, 75, 75)'
                                //,'background-color': 'rgb(183, 183, 183)'
                        })
                    lastcs = cs[Math.round(p)];
                }
            })
            $('#scrollspace').scroll(setHeaders);
            $(window).unload(function() {
                try {
                    //nightmare.end();
                }
                catch (e) {}
            });
        });


        function getFromToTimeText(secs1, secs2) {
            return 'between ' + getTimeText(secs1) + ' and ' + getTimeText(secs2);
        }

        function getTimeText(secs) {
            var hours = Math.floor(secs / 60 / 60);
            var minutes = Math.floor(secs / 60 - hours * 60);
            var seconds = secs - (hours * 60 * 60 + minutes * 60);

            var r = '';
            if (hours > 0) r += hours + ':';
            if (minutes.toString().length == 1) minutes = '0' + minutes;
            if (seconds.toString().length == 1) seconds = '0' + seconds;
            r += minutes + ':' + seconds;
            return r;
        }


        var families = {
            "pop": 0,
            "hip hop": 1,
            "disco": 2,
            "electro house": 3,
            "rhythm and blues": 4,
            "latin": 5,
            "country": 6,
            "metal": 7,
            "rock": 8,
            "folk": 9,
            "blues": 10,
            "reggae": 11,
            "jazz": 12,
            "classical": 13,
            "world": 14
        }
        var familiesks = Object.keys(families);

        var statichtml = false;

        function setup(isinit) {
            if (statichtml && isinit) {
                $('#help').hide();
                $('#helpinit').hide();
                $('#stage').show();
                return;
            }

            if ((isinit && (0 || (playlists.settings.starred.star1.length + playlists.settings.starred.star2.length + playlists.settings.starred.star3.length + playlists.settings.starred.star4.length + playlists.settings.starred.star5.length == 0)))) {
                window.newlistener = true;
                //$('#stage').html('<iframe src="intro.html" style="width: 100%;height: 100%;margin-top: -20px;border: none;position: fixed;right: 8px;left: 295px;padding-right: 295px;box-sizing: border-box;padding-bottom: 171px;"></iframe>');
                help();
                return;

            }
            $('#help').hide();
            $('#helpinit').hide();
            $('#stage').show().html(''); //'<div class="tabs"><div class="selected">Generes</div><div>Playlists</div><div>Explore</div><div>Trending</div></div>');
            if (isinit) addMode = 'init';
            for (var i = 0; i < familiesks.length; i++) {
                var f = familiesks[i];
                if (i == -2) { //} || i==2){
                    if (isinit) dosearch(f + ' music', 'genere');
                }
                else {
                    $('<a class="mnulink" href="/'+f.replace(' ','+')+'" ><div class="searchheader slidein genere" style="   white-space: nowrap;cursor:pointer;overflow:hidden;display: inline-block;margin: 20px 20px 0px 20px;cursor:pointer;    display: inline-block;font-size: 30px;padding: 10px 15px 10px 30px;' + (i % 3 == -1 ? 'float:right;' : i % 6 < 0 ? 'margin-left:100px;' : '') + ' " onclick="dosearch(\'' + f + ' music\',\'genere\');$(\'.genere, .tabs\').remove();"><span class="sprite" style="background-position:-' + ((i + 3) * 210) + 'px 5px;width:100px;height:100px; margin-right: 15px;"></span>' + f.capitalize() + '<div class="dosearch searchtool" ></div></div></a>' + (familiesks.length == i + 1 ? '<div class="spacer"></div>' : '')).appendTo('#stage');
                }
            }
            $('.tabs>div').click(function() {
                // debugger;
                $('.tabs>div.selected').removeClass('selected');
                $(this).addClass('selected');
            })
            if (isinit) setTimeout(function() {
                addMode = 'distribute';
            }, 6000);

            history.pushState({ page: '/'}, null, '/');
            bindlinks();

        }

        function bindlinks(){

            // Used to detect initial (useless) popstate.
            // If history.state exists, pushState() has created the current entry so we can
            // assume browser isn't going to fire initial popstate
            var popped = ('state' in window.history && window.history.state !== null), initialURL = location.href;

            var content = $('#content');

            var ajaxLoadPage = function (url) {

                console.log('Loading ' + url + ' fragment');
                content.load(url + '?fragment=true');

            }
            //debugger;
            // Handle click event of all links with href not starting with http, https or #
            $('a.mnulink').on('click', function (e) {
                //debugger;
                e.preventDefault();
                var href = $(this).attr('href');
                //ajaxLoadPage(href);
                history.pushState({ page: href }, null, href);
                showSuggestionsPanel();

            });

            $(window).bind('popstate', function(event){

                // Ignore inital popstate that some browsers fire on page load
                var initialPop = !popped && location.href == initialURL;
                popped = true;
                if (initialPop) return;

                console.log('Popstate');

                // By the time popstate has fired, location.pathname has been changed
                //ajaxLoadPage(location.pathname);

            });

        }


        String.prototype.capitalize = function() {
            return this.charAt(0).toUpperCase() + this.slice(1);
        }

        function showSocial() {
            $('.overlay.launchpad.opaque').fadeIn(10).addClass('active');
        }
    </script>







    <div id="sharebutton" onclick="showSocial()">Share the Love</div>
    <div class="arthref arthrefSocialShare">
        <div class="overlay launchpad opaque" onclick="$(this).removeClass('active').css('display','none')" style="">
            <div class="icon-container">
                <div class="centered">
                    <ul class="active">
                        <li><a href="#" onclick="opener('http://www.facebook.com/sharer.php?u=http://listricity.com#&amp;t=Look%20what%20I%20found')" class="aFacebook"><span></span></a><span>Facebook</span></li>
                        <li><a href="#" onclick="opener('http://twitter.com/home?status=Look%20what%20I%20found%20http://listricity.com#')" class="aTwitter"><span></span></a><span>Twitter</span></li>
                        <li><a href="#" onclick="opener('https://plus.google.com/share?url=http://listricity.com#')" class="aGooglePlus"><span></span></a><span>Google+</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>



    <div id="coverad" class="coveradmin" onclick="$(this).toggleClass('coveradmin')"></div>
</body>





<script>
    function myCallback(data) {
        debugger;
        alert('it works! ', JSON.parse(data).awesome);
    }





    /*!
     * URI.js - Mutating URLs
     *
     * Version: 1.17.1
     *
     * Author: Rodney Rehm
     * Web: http://medialize.github.io/URI.js/
     *
     * Licensed under
     *   MIT License http://www.opensource.org/licenses/mit-license
     *
     */
    (function(root, factory) {
        'use strict';
        // https://github.com/umdjs/umd/blob/master/returnExports.js
        if (typeof exports === 'object') {
            // Node
            module.exports = factory(require('./punycode'), require('./IPv6'), require('./SecondLevelDomains'));
        }
        else if (typeof define === 'function' && define.amd) {
            // AMD. Register as an anonymous module.
            define(['./punycode', './IPv6', './SecondLevelDomains'], factory);
        }
        else {
            // Browser globals (root is window)
            root.URI = factory(root.punycode, root.IPv6, root.SecondLevelDomains, root);
        }
    }(this, function(punycode, IPv6, SLD, root) {
        'use strict';
        /*global location, escape, unescape */
        // FIXME: v2.0.0 renamce non-camelCase properties to uppercase
        /*jshint camelcase: false */

        // save current URI variable, if any
        var _URI = root && root.URI;

        function URI(url, base) {
            var _urlSupplied = arguments.length >= 1;
            var _baseSupplied = arguments.length >= 2;

            // Allow instantiation without the 'new' keyword
            if (!(this instanceof URI)) {
                if (_urlSupplied) {
                    if (_baseSupplied) {
                        return new URI(url, base);
                    }

                    return new URI(url);
                }

                return new URI();
            }

            if (url === undefined) {
                if (_urlSupplied) {
                    throw new TypeError('undefined is not a valid argument for URI');
                }

                if (typeof location !== 'undefined') {
                    url = location.href + '';
                }
                else {
                    url = '';
                }
            }

            this.href(url);

            // resolve to base according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#constructor
            if (base !== undefined) {
                return this.absoluteTo(base);
            }

            return this;
        }

        URI.version = '1.17.1';

        var p = URI.prototype;
        var hasOwn = Object.prototype.hasOwnProperty;

        function escapeRegEx(string) {
            // https://github.com/medialize/URI.js/commit/85ac21783c11f8ccab06106dba9735a31a86924d#commitcomment-821963
            return string.replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
        }

        function getType(value) {
            // IE8 doesn't return [Object Undefined] but [Object Object] for undefined value
            if (value === undefined) {
                return 'Undefined';
            }

            return String(Object.prototype.toString.call(value)).slice(8, -1);
        }

        function isArray(obj) {
            return getType(obj) === 'Array';
        }

        function filterArrayValues(data, value) {
            var lookup = {};
            var i, length;

            if (getType(value) === 'RegExp') {
                lookup = null;
            }
            else if (isArray(value)) {
                for (i = 0, length = value.length; i < length; i++) {
                    lookup[value[i]] = true;
                }
            }
            else {
                lookup[value] = true;
            }

            for (i = 0, length = data.length; i < length; i++) {
                /*jshint laxbreak: true */
                var _match = lookup && lookup[data[i]] !== undefined || !lookup && value.test(data[i]);
                /*jshint laxbreak: false */
                if (_match) {
                    data.splice(i, 1);
                    length--;
                    i--;
                }
            }

            return data;
        }

        function arrayContains(list, value) {
            var i, length;

            // value may be string, number, array, regexp
            if (isArray(value)) {
                // Note: this can be optimized to O(n) (instead of current O(m * n))
                for (i = 0, length = value.length; i < length; i++) {
                    if (!arrayContains(list, value[i])) {
                        return false;
                    }
                }

                return true;
            }

            var _type = getType(value);
            for (i = 0, length = list.length; i < length; i++) {
                if (_type === 'RegExp') {
                    if (typeof list[i] === 'string' && list[i].match(value)) {
                        return true;
                    }
                }
                else if (list[i] === value) {
                    return true;
                }
            }

            return false;
        }

        function arraysEqual(one, two) {
            if (!isArray(one) || !isArray(two)) {
                return false;
            }

            // arrays can't be equal if they have different amount of content
            if (one.length !== two.length) {
                return false;
            }

            one.sort();
            two.sort();

            for (var i = 0, l = one.length; i < l; i++) {
                if (one[i] !== two[i]) {
                    return false;
                }
            }

            return true;
        }

        function trimSlashes(text) {
            var trim_expression = /^\/+|\/+$/g;
            return text.replace(trim_expression, '');
        }

        URI._parts = function() {
            return {
                protocol: null,
                username: null,
                password: null,
                hostname: null,
                urn: null,
                port: null,
                path: null,
                query: null,
                fragment: null,
                // state
                duplicateQueryParameters: URI.duplicateQueryParameters,
                escapeQuerySpace: URI.escapeQuerySpace
            };
        };
        // state: allow duplicate query parameters (a=1&a=1)
        URI.duplicateQueryParameters = false;
        // state: replaces + with %20 (space in query strings)
        URI.escapeQuerySpace = true;
        // static properties
        URI.protocol_expression = /^[a-z][a-z0-9.+-]*$/i;
        URI.idn_expression = /[^a-z0-9\.-]/i;
        URI.punycode_expression = /(xn--)/i;
        // well, 333.444.555.666 matches, but it sure ain't no IPv4 - do we care?
        URI.ip4_expression = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;
        // credits to Rich Brown
        // source: http://forums.intermapper.com/viewtopic.php?p=1096#1096
        // specification: http://www.ietf.org/rfc/rfc4291.txt
        URI.ip6_expression = /^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;
        // expression used is "gruber revised" (@gruber v2) determined to be the
        // best solution in a regex-golf we did a couple of ages ago at
        // * http://mathiasbynens.be/demo/url-regex
        // * http://rodneyrehm.de/t/url-regex.html
        URI.find_uri_expression = /\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig;
        URI.findUri = {
            // valid "scheme://" or "www."
            start: /\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,
            // everything up to the next whitespace
            end: /[\s\r\n]|$/,
            // trim trailing punctuation captured by end RegExp
            trim: /[`!()\[\]{};:'".,<>?«»“”„‘’]+$/
        };
        // http://www.iana.org/assignments/uri-schemes.html
        // http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers#Well-known_ports
        URI.defaultPorts = {
            http: '80',
            https: '443',
            ftp: '21',
            gopher: '70',
            ws: '80',
            wss: '443'
        };
        // allowed hostname characters according to RFC 3986
        // ALPHA DIGIT "-" "." "_" "~" "!" "$" "&" "'" "(" ")" "*" "+" "," ";" "=" %encoded
        // I've never seen a (non-IDN) hostname other than: ALPHA DIGIT . -
        URI.invalid_hostname_characters = /[^a-zA-Z0-9\.-]/;
        // map DOM Elements to their URI attribute
        URI.domAttributes = {
            'a': 'href',
            'blockquote': 'cite',
            'link': 'href',
            'base': 'href',
            'script': 'src',
            'form': 'action',
            'img': 'src',
            'area': 'href',
            'iframe': 'src',
            'embed': 'src',
            'source': 'src',
            'track': 'src',
            'input': 'src', // but only if type="image"
            'audio': 'src',
            'video': 'src'
        };
        URI.getDomAttribute = function(node) {
            if (!node || !node.nodeName) {
                return undefined;
            }

            var nodeName = node.nodeName.toLowerCase();
            // <input> should only expose src for type="image"
            if (nodeName === 'input' && node.type !== 'image') {
                return undefined;
            }

            return URI.domAttributes[nodeName];
        };

        function escapeForDumbFirefox36(value) {
            // https://github.com/medialize/URI.js/issues/91
            return escape(value);
        }

        // encoding / decoding according to RFC3986
        function strictEncodeURIComponent(string) {
            // see https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/encodeURIComponent
            return encodeURIComponent(string)
                .replace(/[!'()*]/g, escapeForDumbFirefox36)
                .replace(/\*/g, '%2A');
        }
        URI.encode = strictEncodeURIComponent;
        URI.decode = decodeURIComponent;
        URI.iso8859 = function() {
            URI.encode = escape;
            URI.decode = unescape;
        };
        URI.unicode = function() {
            URI.encode = strictEncodeURIComponent;
            URI.decode = decodeURIComponent;
        };
        URI.characters = {
            pathname: {
                encode: {
                    // RFC3986 2.1: For consistency, URI producers and normalizers should
                    // use uppercase hexadecimal digits for all percent-encodings.
                    expression: /%(24|26|2B|2C|3B|3D|3A|40)/ig,
                    map: {
                        // -._~!'()*
                        '%24': '$',
                        '%26': '&',
                        '%2B': '+',
                        '%2C': ',',
                        '%3B': ';',
                        '%3D': '=',
                        '%3A': ':',
                        '%40': '@'
                    }
                },
                decode: {
                    expression: /[\/\?#]/g,
                    map: {
                        '/': '%2F',
                        '?': '%3F',
                        '#': '%23'
                    }
                }
            },
            reserved: {
                encode: {
                    // RFC3986 2.1: For consistency, URI producers and normalizers should
                    // use uppercase hexadecimal digits for all percent-encodings.
                    expression: /%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,
                    map: {
                        // gen-delims
                        '%3A': ':',
                        '%2F': '/',
                        '%3F': '?',
                        '%23': '#',
                        '%5B': '[',
                        '%5D': ']',
                        '%40': '@',
                        // sub-delims
                        '%21': '!',
                        '%24': '$',
                        '%26': '&',
                        '%27': '\'',
                        '%28': '(',
                        '%29': ')',
                        '%2A': '*',
                        '%2B': '+',
                        '%2C': ',',
                        '%3B': ';',
                        '%3D': '='
                    }
                }
            },
            urnpath: {
                // The characters under `encode` are the characters called out by RFC 2141 as being acceptable
                // for usage in a URN. RFC2141 also calls out "-", ".", and "_" as acceptable characters, but
                // these aren't encoded by encodeURIComponent, so we don't have to call them out here. Also
                // note that the colon character is not featured in the encoding map; this is because URI.js
                // gives the colons in URNs semantic meaning as the delimiters of path segements, and so it
                // should not appear unencoded in a segment itself.
                // See also the note above about RFC3986 and capitalalized hex digits.
                encode: {
                    expression: /%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,
                    map: {
                        '%21': '!',
                        '%24': '$',
                        '%27': '\'',
                        '%28': '(',
                        '%29': ')',
                        '%2A': '*',
                        '%2B': '+',
                        '%2C': ',',
                        '%3B': ';',
                        '%3D': '=',
                        '%40': '@'
                    }
                },
                // These characters are the characters called out by RFC2141 as "reserved" characters that
                // should never appear in a URN, plus the colon character (see note above).
                decode: {
                    expression: /[\/\?#:]/g,
                    map: {
                        '/': '%2F',
                        '?': '%3F',
                        '#': '%23',
                        ':': '%3A'
                    }
                }
            }
        };
        URI.encodeQuery = function(string, escapeQuerySpace) {
            var escaped = URI.encode(string + '');
            if (escapeQuerySpace === undefined) {
                escapeQuerySpace = URI.escapeQuerySpace;
            }

            return escapeQuerySpace ? escaped.replace(/%20/g, '+') : escaped;
        };
        URI.decodeQuery = function(string, escapeQuerySpace) {
            string += '';
            if (escapeQuerySpace === undefined) {
                escapeQuerySpace = URI.escapeQuerySpace;
            }

            try {
                return URI.decode(escapeQuerySpace ? string.replace(/\+/g, '%20') : string);
            }
            catch (e) {
                // we're not going to mess with weird encodings,
                // give up and return the undecoded original string
                // see https://github.com/medialize/URI.js/issues/87
                // see https://github.com/medialize/URI.js/issues/92
                return string;
            }
        };
        // generate encode/decode path functions
        var _parts = {
            'encode': 'encode',
            'decode': 'decode'
        };
        var _part;
        var generateAccessor = function(_group, _part) {
            return function(string) {
                try {
                    return URI[_part](string + '').replace(URI.characters[_group][_part].expression, function(c) {
                        return URI.characters[_group][_part].map[c];
                    });
                }
                catch (e) {
                    // we're not going to mess with weird encodings,
                    // give up and return the undecoded original string
                    // see https://github.com/medialize/URI.js/issues/87
                    // see https://github.com/medialize/URI.js/issues/92
                    return string;
                }
            };
        };

        for (_part in _parts) {
            URI[_part + 'PathSegment'] = generateAccessor('pathname', _parts[_part]);
            URI[_part + 'UrnPathSegment'] = generateAccessor('urnpath', _parts[_part]);
        }

        var generateSegmentedPathFunction = function(_sep, _codingFuncName, _innerCodingFuncName) {
            return function(string) {
                // Why pass in names of functions, rather than the function objects themselves? The
                // definitions of some functions (but in particular, URI.decode) will occasionally change due
                // to URI.js having ISO8859 and Unicode modes. Passing in the name and getting it will ensure
                // that the functions we use here are "fresh".
                var actualCodingFunc;
                if (!_innerCodingFuncName) {
                    actualCodingFunc = URI[_codingFuncName];
                }
                else {
                    actualCodingFunc = function(string) {
                        return URI[_codingFuncName](URI[_innerCodingFuncName](string));
                    };
                }

                var segments = (string + '').split(_sep);

                for (var i = 0, length = segments.length; i < length; i++) {
                    segments[i] = actualCodingFunc(segments[i]);
                }

                return segments.join(_sep);
            };
        };

        // This takes place outside the above loop because we don't want, e.g., encodeUrnPath functions.
        URI.decodePath = generateSegmentedPathFunction('/', 'decodePathSegment');
        URI.decodeUrnPath = generateSegmentedPathFunction(':', 'decodeUrnPathSegment');
        URI.recodePath = generateSegmentedPathFunction('/', 'encodePathSegment', 'decode');
        URI.recodeUrnPath = generateSegmentedPathFunction(':', 'encodeUrnPathSegment', 'decode');

        URI.encodeReserved = generateAccessor('reserved', 'encode');

        URI.parse = function(string, parts) {
            var pos;
            if (!parts) {
                parts = {};
            }
            // [protocol"://"[username[":"password]"@"]hostname[":"port]"/"?][path]["?"querystring]["#"fragment]

            // extract fragment
            pos = string.indexOf('#');
            if (pos > -1) {
                // escaping?
                parts.fragment = string.substring(pos + 1) || null;
                string = string.substring(0, pos);
            }

            // extract query
            pos = string.indexOf('?');
            if (pos > -1) {
                // escaping?
                parts.query = string.substring(pos + 1) || null;
                string = string.substring(0, pos);
            }

            // extract protocol
            if (string.substring(0, 2) === '//') {
                // relative-scheme
                parts.protocol = null;
                string = string.substring(2);
                // extract "user:pass@host:port"
                string = URI.parseAuthority(string, parts);
            }
            else {
                pos = string.indexOf(':');
                if (pos > -1) {
                    parts.protocol = string.substring(0, pos) || null;
                    if (parts.protocol && !parts.protocol.match(URI.protocol_expression)) {
                        // : may be within the path
                        parts.protocol = undefined;
                    }
                    else if (string.substring(pos + 1, pos + 3) === '//') {
                        string = string.substring(pos + 3);

                        // extract "user:pass@host:port"
                        string = URI.parseAuthority(string, parts);
                    }
                    else {
                        string = string.substring(pos + 1);
                        parts.urn = true;
                    }
                }
            }

            // what's left must be the path
            parts.path = string;

            // and we're done
            return parts;
        };
        URI.parseHost = function(string, parts) {
            // Copy chrome, IE, opera backslash-handling behavior.
            // Back slashes before the query string get converted to forward slashes
            // See: https://github.com/joyent/node/blob/386fd24f49b0e9d1a8a076592a404168faeecc34/lib/url.js#L115-L124
            // See: https://code.google.com/p/chromium/issues/detail?id=25916
            // https://github.com/medialize/URI.js/pull/233
            string = string.replace(/\\/g, '/');

            // extract host:port
            var pos = string.indexOf('/');
            var bracketPos;
            var t;

            if (pos === -1) {
                pos = string.length;
            }

            if (string.charAt(0) === '[') {
                // IPv6 host - http://tools.ietf.org/html/draft-ietf-6man-text-addr-representation-04#section-6
                // I claim most client software breaks on IPv6 anyways. To simplify things, URI only accepts
                // IPv6+port in the format [2001:db8::1]:80 (for the time being)
                bracketPos = string.indexOf(']');
                parts.hostname = string.substring(1, bracketPos) || null;
                parts.port = string.substring(bracketPos + 2, pos) || null;
                if (parts.port === '/') {
                    parts.port = null;
                }
            }
            else {
                var firstColon = string.indexOf(':');
                var firstSlash = string.indexOf('/');
                var nextColon = string.indexOf(':', firstColon + 1);
                if (nextColon !== -1 && (firstSlash === -1 || nextColon < firstSlash)) {
                    // IPv6 host contains multiple colons - but no port
                    // this notation is actually not allowed by RFC 3986, but we're a liberal parser
                    parts.hostname = string.substring(0, pos) || null;
                    parts.port = null;
                }
                else {
                    t = string.substring(0, pos).split(':');
                    parts.hostname = t[0] || null;
                    parts.port = t[1] || null;
                }
            }

            if (parts.hostname && string.substring(pos).charAt(0) !== '/') {
                pos++;
                string = '/' + string;
            }

            return string.substring(pos) || '/';
        };
        URI.parseAuthority = function(string, parts) {
            string = URI.parseUserinfo(string, parts);
            return URI.parseHost(string, parts);
        };
        URI.parseUserinfo = function(string, parts) {
            // extract username:password
            var firstSlash = string.indexOf('/');
            var pos = string.lastIndexOf('@', firstSlash > -1 ? firstSlash : string.length - 1);
            var t;

            // authority@ must come before /path
            if (pos > -1 && (firstSlash === -1 || pos < firstSlash)) {
                t = string.substring(0, pos).split(':');
                parts.username = t[0] ? URI.decode(t[0]) : null;
                t.shift();
                parts.password = t[0] ? URI.decode(t.join(':')) : null;
                string = string.substring(pos + 1);
            }
            else {
                parts.username = null;
                parts.password = null;
            }

            return string;
        };
        URI.parseQuery = function(string, escapeQuerySpace) {
            if (!string) {
                return {};
            }

            // throw out the funky business - "?"[name"="value"&"]+
            string = string.replace(/&+/g, '&').replace(/^\?*&*|&+$/g, '');

            if (!string) {
                return {};
            }

            var items = {};
            var splits = string.split('&');
            var length = splits.length;
            var v, name, value;

            for (var i = 0; i < length; i++) {
                v = splits[i].split('=');
                name = URI.decodeQuery(v.shift(), escapeQuerySpace);
                // no "=" is null according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#collect-url-parameters
                value = v.length ? URI.decodeQuery(v.join('='), escapeQuerySpace) : null;

                if (hasOwn.call(items, name)) {
                    if (typeof items[name] === 'string' || items[name] === null) {
                        items[name] = [items[name]];
                    }

                    items[name].push(value);
                }
                else {
                    items[name] = value;
                }
            }

            return items;
        };

        URI.build = function(parts) {
            var t = '';

            if (parts.protocol) {
                t += parts.protocol + ':';
            }

            if (!parts.urn && (t || parts.hostname)) {
                t += '//';
            }

            t += (URI.buildAuthority(parts) || '');

            if (typeof parts.path === 'string') {
                if (parts.path.charAt(0) !== '/' && typeof parts.hostname === 'string') {
                    t += '/';
                }

                t += parts.path;
            }

            if (typeof parts.query === 'string' && parts.query) {
                t += '?' + parts.query;
            }

            if (typeof parts.fragment === 'string' && parts.fragment) {
                t += '#' + parts.fragment;
            }
            return t;
        };
        URI.buildHost = function(parts) {
            var t = '';

            if (!parts.hostname) {
                return '';
            }
            else if (URI.ip6_expression.test(parts.hostname)) {
                t += '[' + parts.hostname + ']';
            }
            else {
                t += parts.hostname;
            }

            if (parts.port) {
                t += ':' + parts.port;
            }

            return t;
        };
        URI.buildAuthority = function(parts) {
            return URI.buildUserinfo(parts) + URI.buildHost(parts);
        };
        URI.buildUserinfo = function(parts) {
            var t = '';

            if (parts.username) {
                t += URI.encode(parts.username);

                if (parts.password) {
                    t += ':' + URI.encode(parts.password);
                }

                t += '@';
            }

            return t;
        };
        URI.buildQuery = function(data, duplicateQueryParameters, escapeQuerySpace) {
            // according to http://tools.ietf.org/html/rfc3986 or http://labs.apache.org/webarch/uri/rfc/rfc3986.html
            // being »-._~!$&'()*+,;=:@/?« %HEX and alnum are allowed
            // the RFC explicitly states ?/foo being a valid use case, no mention of parameter syntax!
            // URI.js treats the query string as being application/x-www-form-urlencoded
            // see http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type

            var t = '';
            var unique, key, i, length;
            for (key in data) {
                if (hasOwn.call(data, key) && key) {
                    if (isArray(data[key])) {
                        unique = {};
                        for (i = 0, length = data[key].length; i < length; i++) {
                            if (data[key][i] !== undefined && unique[data[key][i] + ''] === undefined) {
                                t += '&' + URI.buildQueryParameter(key, data[key][i], escapeQuerySpace);
                                if (duplicateQueryParameters !== true) {
                                    unique[data[key][i] + ''] = true;
                                }
                            }
                        }
                    }
                    else if (data[key] !== undefined) {
                        t += '&' + URI.buildQueryParameter(key, data[key], escapeQuerySpace);
                    }
                }
            }

            return t.substring(1);
        };
        URI.buildQueryParameter = function(name, value, escapeQuerySpace) {
            // http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type -- application/x-www-form-urlencoded
            // don't append "=" for null values, according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#url-parameter-serialization
            return URI.encodeQuery(name, escapeQuerySpace) + (value !== null ? '=' + URI.encodeQuery(value, escapeQuerySpace) : '');
        };

        URI.addQuery = function(data, name, value) {
            if (typeof name === 'object') {
                for (var key in name) {
                    if (hasOwn.call(name, key)) {
                        URI.addQuery(data, key, name[key]);
                    }
                }
            }
            else if (typeof name === 'string') {
                if (data[name] === undefined) {
                    data[name] = value;
                    return;
                }
                else if (typeof data[name] === 'string') {
                    data[name] = [data[name]];
                }

                if (!isArray(value)) {
                    value = [value];
                }

                data[name] = (data[name] || []).concat(value);
            }
            else {
                throw new TypeError('URI.addQuery() accepts an object, string as the name parameter');
            }
        };
        URI.removeQuery = function(data, name, value) {
            var i, length, key;

            if (isArray(name)) {
                for (i = 0, length = name.length; i < length; i++) {
                    data[name[i]] = undefined;
                }
            }
            else if (getType(name) === 'RegExp') {
                for (key in data) {
                    if (name.test(key)) {
                        data[key] = undefined;
                    }
                }
            }
            else if (typeof name === 'object') {
                for (key in name) {
                    if (hasOwn.call(name, key)) {
                        URI.removeQuery(data, key, name[key]);
                    }
                }
            }
            else if (typeof name === 'string') {
                if (value !== undefined) {
                    if (getType(value) === 'RegExp') {
                        if (!isArray(data[name]) && value.test(data[name])) {
                            data[name] = undefined;
                        }
                        else {
                            data[name] = filterArrayValues(data[name], value);
                        }
                    }
                    else if (data[name] === String(value) && (!isArray(value) || value.length === 1)) {
                        data[name] = undefined;
                    }
                    else if (isArray(data[name])) {
                        data[name] = filterArrayValues(data[name], value);
                    }
                }
                else {
                    data[name] = undefined;
                }
            }
            else {
                throw new TypeError('URI.removeQuery() accepts an object, string, RegExp as the first parameter');
            }
        };
        URI.hasQuery = function(data, name, value, withinArray) {
            switch (getType(name)) {
                case 'String':
                    // Nothing to do here
                    break;

                case 'RegExp':
                    for (var key in data) {
                        if (hasOwn.call(data, key)) {
                            if (name.test(key) && (value === undefined || URI.hasQuery(data, key, value))) {
                                return true;
                            }
                        }
                    }

                    return false;

                case 'Object':
                    for (var _key in name) {
                        if (hasOwn.call(name, _key)) {
                            if (!URI.hasQuery(data, _key, name[_key])) {
                                return false;
                            }
                        }
                    }

                    return true;

                default:
                    throw new TypeError('URI.hasQuery() accepts a string, regular expression or object as the name parameter');
            }

            switch (getType(value)) {
                case 'Undefined':
                    // true if exists (but may be empty)
                    return name in data; // data[name] !== undefined;

                case 'Boolean':
                    // true if exists and non-empty
                    var _booly = Boolean(isArray(data[name]) ? data[name].length : data[name]);
                    return value === _booly;

                case 'Function':
                    // allow complex comparison
                    return !!value(data[name], name, data);

                case 'Array':
                    if (!isArray(data[name])) {
                        return false;
                    }

                    var op = withinArray ? arrayContains : arraysEqual;
                    return op(data[name], value);

                case 'RegExp':
                    if (!isArray(data[name])) {
                        return Boolean(data[name] && data[name].match(value));
                    }

                    if (!withinArray) {
                        return false;
                    }

                    return arrayContains(data[name], value);

                case 'Number':
                    value = String(value);
                    /* falls through */
                case 'String':
                    if (!isArray(data[name])) {
                        return data[name] === value;
                    }

                    if (!withinArray) {
                        return false;
                    }

                    return arrayContains(data[name], value);

                default:
                    throw new TypeError('URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter');
            }
        };


        URI.commonPath = function(one, two) {
            var length = Math.min(one.length, two.length);
            var pos;

            // find first non-matching character
            for (pos = 0; pos < length; pos++) {
                if (one.charAt(pos) !== two.charAt(pos)) {
                    pos--;
                    break;
                }
            }

            if (pos < 1) {
                return one.charAt(0) === two.charAt(0) && one.charAt(0) === '/' ? '/' : '';
            }

            // revert to last /
            if (one.charAt(pos) !== '/' || two.charAt(pos) !== '/') {
                pos = one.substring(0, pos).lastIndexOf('/');
            }

            return one.substring(0, pos + 1);
        };

        URI.withinString = function(string, callback, options) {
            options || (options = {});
            var _start = options.start || URI.findUri.start;
            var _end = options.end || URI.findUri.end;
            var _trim = options.trim || URI.findUri.trim;
            var _attributeOpen = /[a-z0-9-]=["']?$/i;

            _start.lastIndex = 0;
            while (true) {
                var match = _start.exec(string);
                if (!match) {
                    break;
                }

                var start = match.index;
                if (options.ignoreHtml) {
                    // attribut(e=["']?$)
                    var attributeOpen = string.slice(Math.max(start - 3, 0), start);
                    if (attributeOpen && _attributeOpen.test(attributeOpen)) {
                        continue;
                    }
                }

                var end = start + string.slice(start).search(_end);
                var slice = string.slice(start, end).replace(_trim, '');
                if (options.ignore && options.ignore.test(slice)) {
                    continue;
                }

                end = start + slice.length;
                var result = callback(slice, start, end, string);
                string = string.slice(0, start) + result + string.slice(end);
                _start.lastIndex = start + result.length;
            }

            _start.lastIndex = 0;
            return string;
        };

        URI.ensureValidHostname = function(v) {
            // Theoretically URIs allow percent-encoding in Hostnames (according to RFC 3986)
            // they are not part of DNS and therefore ignored by URI.js

            if (v.match(URI.invalid_hostname_characters)) {
                // test punycode
                if (!punycode) {
                    throw new TypeError('Hostname "' + v + '" contains characters other than [A-Z0-9.-] and Punycode.js is not available');
                }

                if (punycode.toASCII(v).match(URI.invalid_hostname_characters)) {
                    throw new TypeError('Hostname "' + v + '" contains characters other than [A-Z0-9.-]');
                }
            }
        };

        // noConflict
        URI.noConflict = function(removeAll) {
            if (removeAll) {
                var unconflicted = {
                    URI: this.noConflict()
                };

                if (root.URITemplate && typeof root.URITemplate.noConflict === 'function') {
                    unconflicted.URITemplate = root.URITemplate.noConflict();
                }

                if (root.IPv6 && typeof root.IPv6.noConflict === 'function') {
                    unconflicted.IPv6 = root.IPv6.noConflict();
                }

                if (root.SecondLevelDomains && typeof root.SecondLevelDomains.noConflict === 'function') {
                    unconflicted.SecondLevelDomains = root.SecondLevelDomains.noConflict();
                }

                return unconflicted;
            }
            else if (root.URI === this) {
                root.URI = _URI;
            }

            return this;
        };

        p.build = function(deferBuild) {
            if (deferBuild === true) {
                this._deferred_build = true;
            }
            else if (deferBuild === undefined || this._deferred_build) {
                this._string = URI.build(this._parts);
                this._deferred_build = false;
            }

            return this;
        };

        p.clone = function() {
            return new URI(this);
        };

        p.valueOf = p.toString = function() {
            return this.build(false)._string;
        };


        function generateSimpleAccessor(_part) {
            return function(v, build) {
                if (v === undefined) {
                    return this._parts[_part] || '';
                }
                else {
                    this._parts[_part] = v || null;
                    this.build(!build);
                    return this;
                }
            };
        }

        function generatePrefixAccessor(_part, _key) {
            return function(v, build) {
                if (v === undefined) {
                    return this._parts[_part] || '';
                }
                else {
                    if (v !== null) {
                        v = v + '';
                        if (v.charAt(0) === _key) {
                            v = v.substring(1);
                        }
                    }

                    this._parts[_part] = v;
                    this.build(!build);
                    return this;
                }
            };
        }

        p.protocol = generateSimpleAccessor('protocol');
        p.username = generateSimpleAccessor('username');
        p.password = generateSimpleAccessor('password');
        p.hostname = generateSimpleAccessor('hostname');
        p.port = generateSimpleAccessor('port');
        p.query = generatePrefixAccessor('query', '?');
        p.fragment = generatePrefixAccessor('fragment', '#');

        p.search = function(v, build) {
            var t = this.query(v, build);
            return typeof t === 'string' && t.length ? ('?' + t) : t;
        };
        p.hash = function(v, build) {
            var t = this.fragment(v, build);
            return typeof t === 'string' && t.length ? ('#' + t) : t;
        };

        p.pathname = function(v, build) {
            if (v === undefined || v === true) {
                var res = this._parts.path || (this._parts.hostname ? '/' : '');
                return v ? (this._parts.urn ? URI.decodeUrnPath : URI.decodePath)(res) : res;
            }
            else {
                if (this._parts.urn) {
                    this._parts.path = v ? URI.recodeUrnPath(v) : '';
                }
                else {
                    this._parts.path = v ? URI.recodePath(v) : '/';
                }
                this.build(!build);
                return this;
            }
        };
        p.path = p.pathname;
        p.href = function(href, build) {
            var key;

            if (href === undefined) {
                return this.toString();
            }

            this._string = '';
            this._parts = URI._parts();

            var _URI = href instanceof URI;
            var _object = typeof href === 'object' && (href.hostname || href.path || href.pathname);
            if (href.nodeName) {
                var attribute = URI.getDomAttribute(href);
                href = href[attribute] || '';
                _object = false;
            }

            // window.location is reported to be an object, but it's not the sort
            // of object we're looking for:
            // * location.protocol ends with a colon
            // * location.query != object.search
            // * location.hash != object.fragment
            // simply serializing the unknown object should do the trick
            // (for location, not for everything...)
            if (!_URI && _object && href.pathname !== undefined) {
                href = href.toString();
            }

            if (typeof href === 'string' || href instanceof String) {
                this._parts = URI.parse(String(href), this._parts);
            }
            else if (_URI || _object) {
                var src = _URI ? href._parts : href;
                for (key in src) {
                    if (hasOwn.call(this._parts, key)) {
                        this._parts[key] = src[key];
                    }
                }
            }
            else {
                throw new TypeError('invalid input');
            }

            this.build(!build);
            return this;
        };

        // identification accessors
        p.is = function(what) {
            var ip = false;
            var ip4 = false;
            var ip6 = false;
            var name = false;
            var sld = false;
            var idn = false;
            var punycode = false;
            var relative = !this._parts.urn;

            if (this._parts.hostname) {
                relative = false;
                ip4 = URI.ip4_expression.test(this._parts.hostname);
                ip6 = URI.ip6_expression.test(this._parts.hostname);
                ip = ip4 || ip6;
                name = !ip;
                sld = name && SLD && SLD.has(this._parts.hostname);
                idn = name && URI.idn_expression.test(this._parts.hostname);
                punycode = name && URI.punycode_expression.test(this._parts.hostname);
            }

            switch (what.toLowerCase()) {
                case 'relative':
                    return relative;

                case 'absolute':
                    return !relative;

                    // hostname identification
                case 'domain':
                case 'name':
                    return name;

                case 'sld':
                    return sld;

                case 'ip':
                    return ip;

                case 'ip4':
                case 'ipv4':
                case 'inet4':
                    return ip4;

                case 'ip6':
                case 'ipv6':
                case 'inet6':
                    return ip6;

                case 'idn':
                    return idn;

                case 'url':
                    return !this._parts.urn;

                case 'urn':
                    return !!this._parts.urn;

                case 'punycode':
                    return punycode;
            }

            return null;
        };

        // component specific input validation
        var _protocol = p.protocol;
        var _port = p.port;
        var _hostname = p.hostname;

        p.protocol = function(v, build) {
            if (v !== undefined) {
                if (v) {
                    // accept trailing ://
                    v = v.replace(/:(\/\/)?$/, '');

                    if (!v.match(URI.protocol_expression)) {
                        throw new TypeError('Protocol "' + v + '" contains characters other than [A-Z0-9.+-] or doesn\'t start with [A-Z]');
                    }
                }
            }
            return _protocol.call(this, v, build);
        };
        p.scheme = p.protocol;
        p.port = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (v !== undefined) {
                if (v === 0) {
                    v = null;
                }

                if (v) {
                    v += '';
                    if (v.charAt(0) === ':') {
                        v = v.substring(1);
                    }

                    if (v.match(/[^0-9]/)) {
                        throw new TypeError('Port "' + v + '" contains characters other than [0-9]');
                    }
                }
            }
            return _port.call(this, v, build);
        };
        p.hostname = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (v !== undefined) {
                var x = {};
                var res = URI.parseHost(v, x);
                if (res !== '/') {
                    throw new TypeError('Hostname "' + v + '" contains characters other than [A-Z0-9.-]');
                }

                v = x.hostname;
            }
            return _hostname.call(this, v, build);
        };

        // compound accessors
        p.origin = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (v === undefined) {
                var protocol = this.protocol();
                var authority = this.authority();
                if (!authority) {
                    return '';
                }

                return (protocol ? protocol + '://' : '') + this.authority();
            }
            else {
                var origin = URI(v);
                this
                    .protocol(origin.protocol())
                    .authority(origin.authority())
                    .build(!build);
                return this;
            }
        };
        p.host = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (v === undefined) {
                return this._parts.hostname ? URI.buildHost(this._parts) : '';
            }
            else {
                var res = URI.parseHost(v, this._parts);
                if (res !== '/') {
                    throw new TypeError('Hostname "' + v + '" contains characters other than [A-Z0-9.-]');
                }

                this.build(!build);
                return this;
            }
        };
        p.authority = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (v === undefined) {
                return this._parts.hostname ? URI.buildAuthority(this._parts) : '';
            }
            else {
                var res = URI.parseAuthority(v, this._parts);
                if (res !== '/') {
                    throw new TypeError('Hostname "' + v + '" contains characters other than [A-Z0-9.-]');
                }

                this.build(!build);
                return this;
            }
        };
        p.userinfo = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (v === undefined) {
                if (!this._parts.username) {
                    return '';
                }

                var t = URI.buildUserinfo(this._parts);
                return t.substring(0, t.length - 1);
            }
            else {
                if (v[v.length - 1] !== '@') {
                    v += '@';
                }

                URI.parseUserinfo(v, this._parts);
                this.build(!build);
                return this;
            }
        };
        p.resource = function(v, build) {
            var parts;

            if (v === undefined) {
                return this.path() + this.search() + this.hash();
            }

            parts = URI.parse(v);
            this._parts.path = parts.path;
            this._parts.query = parts.query;
            this._parts.fragment = parts.fragment;
            this.build(!build);
            return this;
        };

        // fraction accessors
        p.subdomain = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            // convenience, return "www" from "www.example.org"
            if (v === undefined) {
                if (!this._parts.hostname || this.is('IP')) {
                    return '';
                }

                // grab domain and add another segment
                var end = this._parts.hostname.length - this.domain().length - 1;
                return this._parts.hostname.substring(0, end) || '';
            }
            else {
                var e = this._parts.hostname.length - this.domain().length;
                var sub = this._parts.hostname.substring(0, e);
                var replace = new RegExp('^' + escapeRegEx(sub));

                if (v && v.charAt(v.length - 1) !== '.') {
                    v += '.';
                }

                if (v) {
                    URI.ensureValidHostname(v);
                }

                this._parts.hostname = this._parts.hostname.replace(replace, v);
                this.build(!build);
                return this;
            }
        };
        p.domain = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (typeof v === 'boolean') {
                build = v;
                v = undefined;
            }

            // convenience, return "example.org" from "www.example.org"
            if (v === undefined) {
                if (!this._parts.hostname || this.is('IP')) {
                    return '';
                }

                // if hostname consists of 1 or 2 segments, it must be the domain
                var t = this._parts.hostname.match(/\./g);
                if (t && t.length < 2) {
                    return this._parts.hostname;
                }

                // grab tld and add another segment
                var end = this._parts.hostname.length - this.tld(build).length - 1;
                end = this._parts.hostname.lastIndexOf('.', end - 1) + 1;
                return this._parts.hostname.substring(end) || '';
            }
            else {
                if (!v) {
                    throw new TypeError('cannot set domain empty');
                }

                URI.ensureValidHostname(v);

                if (!this._parts.hostname || this.is('IP')) {
                    this._parts.hostname = v;
                }
                else {
                    var replace = new RegExp(escapeRegEx(this.domain()) + '$');
                    this._parts.hostname = this._parts.hostname.replace(replace, v);
                }

                this.build(!build);
                return this;
            }
        };
        p.tld = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (typeof v === 'boolean') {
                build = v;
                v = undefined;
            }

            // return "org" from "www.example.org"
            if (v === undefined) {
                if (!this._parts.hostname || this.is('IP')) {
                    return '';
                }

                var pos = this._parts.hostname.lastIndexOf('.');
                var tld = this._parts.hostname.substring(pos + 1);

                if (build !== true && SLD && SLD.list[tld.toLowerCase()]) {
                    return SLD.get(this._parts.hostname) || tld;
                }

                return tld;
            }
            else {
                var replace;

                if (!v) {
                    throw new TypeError('cannot set TLD empty');
                }
                else if (v.match(/[^a-zA-Z0-9-]/)) {
                    if (SLD && SLD.is(v)) {
                        replace = new RegExp(escapeRegEx(this.tld()) + '$');
                        this._parts.hostname = this._parts.hostname.replace(replace, v);
                    }
                    else {
                        throw new TypeError('TLD "' + v + '" contains characters other than [A-Z0-9]');
                    }
                }
                else if (!this._parts.hostname || this.is('IP')) {
                    throw new ReferenceError('cannot set TLD on non-domain host');
                }
                else {
                    replace = new RegExp(escapeRegEx(this.tld()) + '$');
                    this._parts.hostname = this._parts.hostname.replace(replace, v);
                }

                this.build(!build);
                return this;
            }
        };
        p.directory = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (v === undefined || v === true) {
                if (!this._parts.path && !this._parts.hostname) {
                    return '';
                }

                if (this._parts.path === '/') {
                    return '/';
                }

                var end = this._parts.path.length - this.filename().length - 1;
                var res = this._parts.path.substring(0, end) || (this._parts.hostname ? '/' : '');

                return v ? URI.decodePath(res) : res;

            }
            else {
                var e = this._parts.path.length - this.filename().length;
                var directory = this._parts.path.substring(0, e);
                var replace = new RegExp('^' + escapeRegEx(directory));

                // fully qualifier directories begin with a slash
                if (!this.is('relative')) {
                    if (!v) {
                        v = '/';
                    }

                    if (v.charAt(0) !== '/') {
                        v = '/' + v;
                    }
                }

                // directories always end with a slash
                if (v && v.charAt(v.length - 1) !== '/') {
                    v += '/';
                }

                v = URI.recodePath(v);
                this._parts.path = this._parts.path.replace(replace, v);
                this.build(!build);
                return this;
            }
        };
        p.filename = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (v === undefined || v === true) {
                if (!this._parts.path || this._parts.path === '/') {
                    return '';
                }

                var pos = this._parts.path.lastIndexOf('/');
                var res = this._parts.path.substring(pos + 1);

                return v ? URI.decodePathSegment(res) : res;
            }
            else {
                var mutatedDirectory = false;

                if (v.charAt(0) === '/') {
                    v = v.substring(1);
                }

                if (v.match(/\.?\//)) {
                    mutatedDirectory = true;
                }

                var replace = new RegExp(escapeRegEx(this.filename()) + '$');
                v = URI.recodePath(v);
                this._parts.path = this._parts.path.replace(replace, v);

                if (mutatedDirectory) {
                    this.normalizePath(build);
                }
                else {
                    this.build(!build);
                }

                return this;
            }
        };
        p.suffix = function(v, build) {
            if (this._parts.urn) {
                return v === undefined ? '' : this;
            }

            if (v === undefined || v === true) {
                if (!this._parts.path || this._parts.path === '/') {
                    return '';
                }

                var filename = this.filename();
                var pos = filename.lastIndexOf('.');
                var s, res;

                if (pos === -1) {
                    return '';
                }

                // suffix may only contain alnum characters (yup, I made this up.)
                s = filename.substring(pos + 1);
                res = (/^[a-z0-9%]+$/i).test(s) ? s : '';
                return v ? URI.decodePathSegment(res) : res;
            }
            else {
                if (v.charAt(0) === '.') {
                    v = v.substring(1);
                }

                var suffix = this.suffix();
                var replace;

                if (!suffix) {
                    if (!v) {
                        return this;
                    }

                    this._parts.path += '.' + URI.recodePath(v);
                }
                else if (!v) {
                    replace = new RegExp(escapeRegEx('.' + suffix) + '$');
                }
                else {
                    replace = new RegExp(escapeRegEx(suffix) + '$');
                }

                if (replace) {
                    v = URI.recodePath(v);
                    this._parts.path = this._parts.path.replace(replace, v);
                }

                this.build(!build);
                return this;
            }
        };
        p.segment = function(segment, v, build) {
            var separator = this._parts.urn ? ':' : '/';
            var path = this.path();
            var absolute = path.substring(0, 1) === '/';
            var segments = path.split(separator);

            if (segment !== undefined && typeof segment !== 'number') {
                build = v;
                v = segment;
                segment = undefined;
            }

            if (segment !== undefined && typeof segment !== 'number') {
                throw new Error('Bad segment "' + segment + '", must be 0-based integer');
            }

            if (absolute) {
                segments.shift();
            }

            if (segment < 0) {
                // allow negative indexes to address from the end
                segment = Math.max(segments.length + segment, 0);
            }

            if (v === undefined) {
                /*jshint laxbreak: true */
                return segment === undefined ? segments : segments[segment];
                /*jshint laxbreak: false */
            }
            else if (segment === null || segments[segment] === undefined) {
                if (isArray(v)) {
                    segments = [];
                    // collapse empty elements within array
                    for (var i = 0, l = v.length; i < l; i++) {
                        if (!v[i].length && (!segments.length || !segments[segments.length - 1].length)) {
                            continue;
                        }

                        if (segments.length && !segments[segments.length - 1].length) {
                            segments.pop();
                        }

                        segments.push(trimSlashes(v[i]));
                    }
                }
                else if (v || typeof v === 'string') {
                    v = trimSlashes(v);
                    if (segments[segments.length - 1] === '') {
                        // empty trailing elements have to be overwritten
                        // to prevent results such as /foo//bar
                        segments[segments.length - 1] = v;
                    }
                    else {
                        segments.push(v);
                    }
                }
            }
            else {
                if (v) {
                    segments[segment] = trimSlashes(v);
                }
                else {
                    segments.splice(segment, 1);
                }
            }

            if (absolute) {
                segments.unshift('');
            }

            return this.path(segments.join(separator), build);
        };
        p.segmentCoded = function(segment, v, build) {
            var segments, i, l;

            if (typeof segment !== 'number') {
                build = v;
                v = segment;
                segment = undefined;
            }

            if (v === undefined) {
                segments = this.segment(segment, v, build);
                if (!isArray(segments)) {
                    segments = segments !== undefined ? URI.decode(segments) : undefined;
                }
                else {
                    for (i = 0, l = segments.length; i < l; i++) {
                        segments[i] = URI.decode(segments[i]);
                    }
                }

                return segments;
            }

            if (!isArray(v)) {
                v = (typeof v === 'string' || v instanceof String) ? URI.encode(v) : v;
            }
            else {
                for (i = 0, l = v.length; i < l; i++) {
                    v[i] = URI.encode(v[i]);
                }
            }

            return this.segment(segment, v, build);
        };

        // mutating query string
        var q = p.query;
        p.query = function(v, build) {
            if (v === true) {
                return URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
            }
            else if (typeof v === 'function') {
                var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
                var result = v.call(this, data);
                this._parts.query = URI.buildQuery(result || data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);
                this.build(!build);
                return this;
            }
            else if (v !== undefined && typeof v !== 'string') {
                this._parts.query = URI.buildQuery(v, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);
                this.build(!build);
                return this;
            }
            else {
                return q.call(this, v, build);
            }
        };
        p.setQuery = function(name, value, build) {
            var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);

            if (typeof name === 'string' || name instanceof String) {
                data[name] = value !== undefined ? value : null;
            }
            else if (typeof name === 'object') {
                for (var key in name) {
                    if (hasOwn.call(name, key)) {
                        data[key] = name[key];
                    }
                }
            }
            else {
                throw new TypeError('URI.addQuery() accepts an object, string as the name parameter');
            }

            this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);
            if (typeof name !== 'string') {
                build = value;
            }

            this.build(!build);
            return this;
        };
        p.addQuery = function(name, value, build) {
            var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
            URI.addQuery(data, name, value === undefined ? null : value);
            this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);
            if (typeof name !== 'string') {
                build = value;
            }

            this.build(!build);
            return this;
        };
        p.removeQuery = function(name, value, build) {
            var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
            URI.removeQuery(data, name, value);
            this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);
            if (typeof name !== 'string') {
                build = value;
            }

            this.build(!build);
            return this;
        };
        p.hasQuery = function(name, value, withinArray) {
            var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
            return URI.hasQuery(data, name, value, withinArray);
        };
        p.setSearch = p.setQuery;
        p.addSearch = p.addQuery;
        p.removeSearch = p.removeQuery;
        p.hasSearch = p.hasQuery;

        // sanitizing URLs
        p.normalize = function() {
            if (this._parts.urn) {
                return this
                    .normalizeProtocol(false)
                    .normalizePath(false)
                    .normalizeQuery(false)
                    .normalizeFragment(false)
                    .build();
            }

            return this
                .normalizeProtocol(false)
                .normalizeHostname(false)
                .normalizePort(false)
                .normalizePath(false)
                .normalizeQuery(false)
                .normalizeFragment(false)
                .build();
        };
        p.normalizeProtocol = function(build) {
            if (typeof this._parts.protocol === 'string') {
                this._parts.protocol = this._parts.protocol.toLowerCase();
                this.build(!build);
            }

            return this;
        };
        p.normalizeHostname = function(build) {
            if (this._parts.hostname) {
                if (this.is('IDN') && punycode) {
                    this._parts.hostname = punycode.toASCII(this._parts.hostname);
                }
                else if (this.is('IPv6') && IPv6) {
                    this._parts.hostname = IPv6.best(this._parts.hostname);
                }

                this._parts.hostname = this._parts.hostname.toLowerCase();
                this.build(!build);
            }

            return this;
        };
        p.normalizePort = function(build) {
            // remove port of it's the protocol's default
            if (typeof this._parts.protocol === 'string' && this._parts.port === URI.defaultPorts[this._parts.protocol]) {
                this._parts.port = null;
                this.build(!build);
            }

            return this;
        };
        p.normalizePath = function(build) {
            var _path = this._parts.path;
            if (!_path) {
                return this;
            }

            if (this._parts.urn) {
                this._parts.path = URI.recodeUrnPath(this._parts.path);
                this.build(!build);
                return this;
            }

            if (this._parts.path === '/') {
                return this;
            }

            _path = URI.recodePath(_path);

            var _was_relative;
            var _leadingParents = '';
            var _parent, _pos;

            // handle relative paths
            if (_path.charAt(0) !== '/') {
                _was_relative = true;
                _path = '/' + _path;
            }

            // handle relative files (as opposed to directories)
            if (_path.slice(-3) === '/..' || _path.slice(-2) === '/.') {
                _path += '/';
            }

            // resolve simples
            _path = _path
                .replace(/(\/(\.\/)+)|(\/\.$)/g, '/')
                .replace(/\/{2,}/g, '/');

            // remember leading parents
            if (_was_relative) {
                _leadingParents = _path.substring(1).match(/^(\.\.\/)+/) || '';
                if (_leadingParents) {
                    _leadingParents = _leadingParents[0];
                }
            }

            // resolve parents
            while (true) {
                _parent = _path.search(/\/\.\.(\/|$)/);
                if (_parent === -1) {
                    // no more ../ to resolve
                    break;
                }
                else if (_parent === 0) {
                    // top level cannot be relative, skip it
                    _path = _path.substring(3);
                    continue;
                }

                _pos = _path.substring(0, _parent).lastIndexOf('/');
                if (_pos === -1) {
                    _pos = _parent;
                }
                _path = _path.substring(0, _pos) + _path.substring(_parent + 3);
            }

            // revert to relative
            if (_was_relative && this.is('relative')) {
                _path = _leadingParents + _path.substring(1);
            }

            this._parts.path = _path;
            this.build(!build);
            return this;
        };
        p.normalizePathname = p.normalizePath;
        p.normalizeQuery = function(build) {
            if (typeof this._parts.query === 'string') {
                if (!this._parts.query.length) {
                    this._parts.query = null;
                }
                else {
                    this.query(URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace));
                }

                this.build(!build);
            }

            return this;
        };
        p.normalizeFragment = function(build) {
            if (!this._parts.fragment) {
                this._parts.fragment = null;
                this.build(!build);
            }

            return this;
        };
        p.normalizeSearch = p.normalizeQuery;
        p.normalizeHash = p.normalizeFragment;

        p.iso8859 = function() {
            // expect unicode input, iso8859 output
            var e = URI.encode;
            var d = URI.decode;

            URI.encode = escape;
            URI.decode = decodeURIComponent;
            try {
                this.normalize();
            }
            finally {
                URI.encode = e;
                URI.decode = d;
            }
            return this;
        };

        p.unicode = function() {
            // expect iso8859 input, unicode output
            var e = URI.encode;
            var d = URI.decode;

            URI.encode = strictEncodeURIComponent;
            URI.decode = unescape;
            try {
                this.normalize();
            }
            finally {
                URI.encode = e;
                URI.decode = d;
            }
            return this;
        };

        p.readable = function() {
            var uri = this.clone();
            // removing username, password, because they shouldn't be displayed according to RFC 3986
            uri.username('').password('').normalize();
            var t = '';
            if (uri._parts.protocol) {
                t += uri._parts.protocol + '://';
            }

            if (uri._parts.hostname) {
                if (uri.is('punycode') && punycode) {
                    t += punycode.toUnicode(uri._parts.hostname);
                    if (uri._parts.port) {
                        t += ':' + uri._parts.port;
                    }
                }
                else {
                    t += uri.host();
                }
            }

            if (uri._parts.hostname && uri._parts.path && uri._parts.path.charAt(0) !== '/') {
                t += '/';
            }

            t += uri.path(true);
            if (uri._parts.query) {
                var q = '';
                for (var i = 0, qp = uri._parts.query.split('&'), l = qp.length; i < l; i++) {
                    var kv = (qp[i] || '').split('=');
                    q += '&' + URI.decodeQuery(kv[0], this._parts.escapeQuerySpace)
                        .replace(/&/g, '%26');

                    if (kv[1] !== undefined) {
                        q += '=' + URI.decodeQuery(kv[1], this._parts.escapeQuerySpace)
                            .replace(/&/g, '%26');
                    }
                }
                t += '?' + q.substring(1);
            }

            t += URI.decodeQuery(uri.hash(), true);
            return t;
        };

        // resolving relative and absolute URLs
        p.absoluteTo = function(base) {
            var resolved = this.clone();
            var properties = ['protocol', 'username', 'password', 'hostname', 'port'];
            var basedir, i, p;

            if (this._parts.urn) {
                throw new Error('URNs do not have any generally defined hierarchical components');
            }

            if (!(base instanceof URI)) {
                base = new URI(base);
            }

            if (!resolved._parts.protocol) {
                resolved._parts.protocol = base._parts.protocol;
            }

            if (this._parts.hostname) {
                return resolved;
            }

            for (i = 0;
                (p = properties[i]); i++) {
                resolved._parts[p] = base._parts[p];
            }

            if (!resolved._parts.path) {
                resolved._parts.path = base._parts.path;
                if (!resolved._parts.query) {
                    resolved._parts.query = base._parts.query;
                }
            }
            else if (resolved._parts.path.substring(-2) === '..') {
                resolved._parts.path += '/';
            }

            if (resolved.path().charAt(0) !== '/') {
                basedir = base.directory();
                basedir = basedir ? basedir : base.path().indexOf('/') === 0 ? '/' : '';
                resolved._parts.path = (basedir ? (basedir + '/') : '') + resolved._parts.path;
                resolved.normalizePath();
            }

            resolved.build();
            return resolved;
        };
        p.relativeTo = function(base) {
            var relative = this.clone().normalize();
            var relativeParts, baseParts, common, relativePath, basePath;

            if (relative._parts.urn) {
                throw new Error('URNs do not have any generally defined hierarchical components');
            }

            base = new URI(base).normalize();
            relativeParts = relative._parts;
            baseParts = base._parts;
            relativePath = relative.path();
            basePath = base.path();

            if (relativePath.charAt(0) !== '/') {
                throw new Error('URI is already relative');
            }

            if (basePath.charAt(0) !== '/') {
                throw new Error('Cannot calculate a URI relative to another relative URI');
            }

            if (relativeParts.protocol === baseParts.protocol) {
                relativeParts.protocol = null;
            }

            if (relativeParts.username !== baseParts.username || relativeParts.password !== baseParts.password) {
                return relative.build();
            }

            if (relativeParts.protocol !== null || relativeParts.username !== null || relativeParts.password !== null) {
                return relative.build();
            }

            if (relativeParts.hostname === baseParts.hostname && relativeParts.port === baseParts.port) {
                relativeParts.hostname = null;
                relativeParts.port = null;
            }
            else {
                return relative.build();
            }

            if (relativePath === basePath) {
                relativeParts.path = '';
                return relative.build();
            }

            // determine common sub path
            common = URI.commonPath(relativePath, basePath);

            // If the paths have nothing in common, return a relative URL with the absolute path.
            if (!common) {
                return relative.build();
            }

            var parents = baseParts.path
                .substring(common.length)
                .replace(/[^\/]*$/, '')
                .replace(/.*?\//g, '../');

            relativeParts.path = (parents + relativeParts.path.substring(common.length)) || './';

            return relative.build();
        };

        // comparing URIs
        p.equals = function(uri) {
            var one = this.clone();
            var two = new URI(uri);
            var one_map = {};
            var two_map = {};
            var checked = {};
            var one_query, two_query, key;

            one.normalize();
            two.normalize();

            // exact match
            if (one.toString() === two.toString()) {
                return true;
            }

            // extract query string
            one_query = one.query();
            two_query = two.query();
            one.query('');
            two.query('');

            // definitely not equal if not even non-query parts match
            if (one.toString() !== two.toString()) {
                return false;
            }

            // query parameters have the same length, even if they're permuted
            if (one_query.length !== two_query.length) {
                return false;
            }

            one_map = URI.parseQuery(one_query, this._parts.escapeQuerySpace);
            two_map = URI.parseQuery(two_query, this._parts.escapeQuerySpace);

            for (key in one_map) {
                if (hasOwn.call(one_map, key)) {
                    if (!isArray(one_map[key])) {
                        if (one_map[key] !== two_map[key]) {
                            return false;
                        }
                    }
                    else if (!arraysEqual(one_map[key], two_map[key])) {
                        return false;
                    }

                    checked[key] = true;
                }
            }

            for (key in two_map) {
                if (hasOwn.call(two_map, key)) {
                    if (!checked[key]) {
                        // two contains a parameter not present in one
                        return false;
                    }
                }
            }

            return true;
        };

        // state
        p.duplicateQueryParameters = function(v) {
            this._parts.duplicateQueryParameters = !!v;
            return this;
        };

        p.escapeQuerySpace = function(v) {
            this._parts.escapeQuerySpace = !!v;
            return this;
        };

        return URI;
    }));







    /*
    JSONProxy jQuery Plugin, v0.3.1
    https://jsonp.afeld.me

    by Aidan Feldman
    MIT license
    */
    /*jshint browser:true */
    /*global define, jQuery, URI */
    (function(factory) {
        // https://github.com/umdjs/umd/blob/ce6c20e318e58cd301ee929135cf651b02392c08/jqueryPlugin.js
        if (typeof define === 'function' && define.amd) {
            // AMD. Register as an anonymous module.
            define([
                'jquery',
                // https://github.com/medialize/URI.js#requirejs
                'URIjs/URI'
            ], factory);
        }
        else {
            // Browser globals
            factory(jQuery, URI);
        }
    }(function($, URI) {
        // Accepts all jQuery.ajax() options, plus:
        //   corsSupport {Boolean} Set to true if the URL is known to support CORS for this domain.
        //   jsonpSupport {Boolean} Set to true if the URL is known to support JSONP.
        $.jsonp = function(opts) {
            var windowUrl = $.jsonp.getLocation(),
                apiUri = $.jsonp.getApiUri(opts),
                defaultDataType;

            if ($.jsonp.isCrossDomain(URI(windowUrl), apiUri)) {
                var doProxy;

                // favor CORS because it can provide error messages from server to callbacks
                if ($.support.cors) {
                    // use the proxy if the endpoint doesn't support CORS, or if it would be an insecure request from a secure page
                    if (!opts.corsSupport || $.jsonp.isInsecureRequest(apiUri)) {
                        // proxy CORS
                        doProxy = true;
                    } // else direct CORS
                    defaultDataType = 'json';
                }
                else {
                    if (!opts.jsonpSupport) {
                        // proxy JSONP
                        doProxy = true;
                    } // else direct JSONP

                    defaultDataType = 'jsonp';
                    opts.timeout = opts.timeout || 10000; // ensures error callbacks are fired
                }

                if (doProxy) {
                    opts.data = {
                        url: apiUri.toString()
                    };

                    if (opts.dataType === 'text') {
                        // 'raw' request

                        // jQuery(?) doesn't accept JSONP responses with strings passed, so raw responses are wrapped with {data: "..."}.
                        // Mask this to the library user by simply returning the underlying string.
                        opts.dataFilter = function(json) {
                            return json.data;
                        };
                        opts.data.raw = true;
                    }

                    opts.url = $.jsonp.PROXY;
                    opts.dataType = defaultDataType;
                }
            }
            else {
                defaultDataType = 'json';
            }

            opts.dataType = opts.dataType || defaultDataType;

            return $.ajax(opts);
        };

        $.extend($.jsonp, {
            PROXY: 'https://jsonp.afeld.me/',

            // make this available for easier testing
            getLocation: function() {
                return window.location;
            },

            getApiUri: function(ajaxOpts) {
                var windowUrl = $.jsonp.getLocation(),
                    uri = URI(ajaxOpts.url).absoluteTo(windowUrl.href),
                    params;

                if (typeof ajaxOpts.data === 'string') {
                    params = URI.parseQuery(ajaxOpts.data);
                }
                else {
                    params = ajaxOpts.data || {};
                }
                uri.addSearch(params);

                return uri;
            },

            // http://stackoverflow.com/a/1084027/358804
            isCrossDomain: function(uri1, uri2) {
                return (
                    uri1.protocol() !== uri2.protocol() ||
                    uri1.host() !== uri2.host() ||
                    uri1.port() !== uri2.port()
                );
            },

            isInsecureRequest: function(uri) {
                var windowUrl = this.getLocation();
                return windowUrl.protocol === 'https:' && uri.protocol() !== windowUrl.protocol;
            }
        });
    }));



    var req = {
        get: function(o, cb) {
            var lcb = cb;
            console.log(o.url);
            //var lurl=o.url.replace('google.com','google.com.feelter.com').replace('youtube.com','youtube.com.feelter.com').replace('https','http');
            var lurl = o.url.replace('www.youtube.com', 'box.listricity.com').replace('clients1.google.com', 'box1.listricity.com').replace('https', 'http');
            $.getJSON({
                url: lurl,
                // corsSupport: true, // if URL above supports CORS (optional)
                // jsonpSupport: true, // if URL above supports JSONP (optional)

                success: function(data) {
                    //alert('CORS or JSONP! ' + data.awesome);
                    lcb(false, data, data.responseText);
                },

                error: function(data) {
                    //debugger;
                    //alert('CORS or JSONP! ' + data.awesome);
                    lcb(false, data, data.responseText);
                }
            });
            return;
            $.jsonp({
                url: o.url,
                // corsSupport: true, // if URL above supports CORS (optional)
                // jsonpSupport: true, // if URL above supports JSONP (optional)

                success: function(data) {
                    //alert('CORS or JSONP! ' + data.awesome);
                    lcb(false, data, data.responseText);
                },

                error: function(data) {
                    //debugger;
                    //alert('CORS or JSONP! ' + data.awesome);
                    lcb(false, data, data.responseText);
                }
            });

        }
    }
    var isWin = (navigator.appVersion.indexOf("Win") != -1)
    var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
    isWin=!isChrome;
    
    $(document).ready(function() {
        //         var IEversion = detectIE();
        // alert(IEversion);
        // if (IEversion !== false) {
        //   document.location.href='download.html';
        // } else {
        //   //document.getElementById('result').innerHTML = 'NOT IE';
        // }
        bindlinks();

        if (isWin) {
            $('#qcontainer').addClass('windows');
            $('body').addClass('windows');
        }
        loadLists();
        layoutLists();
        setup(true);
        if (statichtml) {
            statichtml = false;
        }


        $("#logo").resizable({
            alsoResize: '#logo_inner',
            autoHide: true,
            minHeight: 166,
            minWidth: 294,
            start: function() {
                $('#logo_inner').hide();
            },
            stop: function() {
                $('#logo_inner').show();
            }
        });
    });
    //debugger;




    var tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // 3. This function creates an <iframe> (and YouTube player)
    //    after the API code downloads.
    var player;

    function onYouTubeIframeAPIReady() {
        if (!window.newlistener) return;
        if (localStorage.getItem('autoplayed') == 'true') return;
        localStorage.setItem('autoplayed', 'true');
        player = new YT.Player('logo_inner', {
            height: '390',
            width: '640',
            origin: 'http://listricity.com',
            videoId: 'VSQ_QVsUP7s',
            playerVars: {
                'autoplay': 1,
                'controls': 1,
                'autohide': 1,
                'wmode': 'opaque',
                'iv_load_policy': 3,
                'modestbranding': 1,
                'showinfo': 0,
                'rel': 0
            },
            events: {
                //'onReady': function(){debugger;event.target.playVideo();},
                'onStateChange': onPlayerStateChange
            }
        });


    }

    // 4. The API will call this function when the video player is ready.
    function onPlayerReady(event) {
        // event.target.playVideo();
    }
    var unstartetimer = false;
    var unstartedconcecutives = 0;

    function onPlayerStateChange(event) {
        setTimeout("$('#logo_inner').css({'transform':'rotateY( 0deg )  scale(1)','opacity':'1'});$('#logo').css({'background-size':'0px'});", 900);
        //console.log(event.data);
        if (unstartetimer) clearTimeout(unstartetimer);
        if (event.data == YT.PlayerState.PAUSED) {
            $('button[onclick="stopVid()"]').html('Play').addClass('playbutton');
        }
        if (event.data == YT.PlayerState.UNSTARTED) {
            unstartetimer = setTimeout(function() {
                unstartetimer = false;
                if (unstartedconcecutives++ < 5);
                playNext()
            }, 3000);
        }
        if (event.data == YT.PlayerState.ENDED) {
            if (window.newlistener) {
                window.newlistener = false
            }
            else playNext();
        }
        if (event.data == YT.PlayerState.PLAYING) {
            unstartedconcecutives = 0;
            $('button[onclick="stopVid()"]').html('Stop').removeClass('playbutton');
        }
    }

    function stopVideo() {
        player.stopVideo();
    }

    function toFullView() {
        $('.titlebar').addClass('titlebar_dock')
        $('#qcontainer').css({
            top: 22
        });
        $('#logo').addClass('logofullview');
        $('#logo_inner').css({
            width: '100%',
            height: '100%'
        });
        $('#coverad').show();
    }

    function fromFullView() {
        $('.titlebar').removeClass('titlebar_dock')
        $('#qcontainer').css({
            top: 188
        });
        $('#logo').removeClass('logofullview');
        $('#logo').css({
            width: '294px',
            height: '166px'
        });
        $('#logo_inner').css({
            width: '100%',
            height: '100%'
        });
        $('#coverad').hide();
    }
</script>


</html>
